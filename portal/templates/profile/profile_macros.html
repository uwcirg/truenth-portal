{% from "initial_queries_macros.html" import patientQGroup, consent_fields %}
{% macro profileImage(person) -%}
    {% if person and person.image_url %}<div class="profile-img hidden-xs"><img src="{{ person and person.image_url }}" /></div>{% endif %}
{%- endmacro %}
{% macro profileSection(editable=True, id="", data_sections="", class="") -%}
    <div id="{%-if id -%}{{id}}{%- endif -%}" class="profile-item-container {%if editable%}editable{%endif%} {{class}}" data-sections="{{data_sections}}">
        {% if editable %}{{profileEditButton()}}{% endif %}
        {{caller()}}
    </div>
{%- endmacro %}
{% macro profileEditButton(class="") -%}
    <span class="section-loader tnth-hide"><i class="fa fa-spinner fa-spin"></i> {{_("loading section data...")}}</span>
    <input type="button" class="btn profile-item-edit-btn {{class}}" value='{{_("Edit")}}' aria-label='{{_("Edit Button")}}'></input>
{%- endmacro %}
{% macro titleSection(id="", class="") -%}
    <h4 id="{%-if id -%}{{id}}{%- endif -%}" class="profile-item-title index-item {{class}}">{{caller()}}</h4>
{%- endmacro %}
{% macro viewSection(class="", id="") -%}
    <div id="{%-if id -%}{{id}}{%- endif -%}" class="view-container {{class}}">{{caller()}}</div>
{%- endmacro %}
{% macro editSection(class="", id="") -%}
    <div id="{%-if id -%}{{id}}{%- endif -%}" class="edit-container {{class}}">{{caller()}}</div>
{%- endmacro %}
{% macro saveLoaderDiv(container_id="") -%}
    <div class="load-container save-loader-wrapper"><i id="{{container_id}}_load" class="fa fa-spinner fa-spin load-icon fa-lg save-info" aria-hidden="true"></i><i id="{{container_id}}_success" class="fa fa-check success-icon save-info" aria-hidden="true">{{_("Updated")}}</i><i id="{{container_id}}_error" class="fa fa-times error-icon save-info" aria-hidden="true">'{{_("Unable to Update. System error.")}}</i></div>
{%- endmacro %}
{% macro emailReadyMessage() -%}
    <email-ready-message v-bind:message="messages.userEmailReadyMessage"></email-ready-message>
{%- endmacro %}
{% macro profileDemo(person, current_user) -%}
    <div class="row" data-profile-section-id="demo">
        <div class="col-md-12 col-sm-12 col-xs-12">
            {% call profileSection(data_sections ='demo') %}
                {% call titleSection(id="patientInformationLoc") %}
                    {% if person.id == current_user.id -%}
                        {{_("My Information")}}
                    {% else %}
                        {% if person.has_role(ROLE.PATIENT.value) -%}
                            {{_("Patient Information") }}
                        {%- else%}
                            {{_("User Information") }}
                        {%- endif%}
                    {% endif %}
                {% endcall %}
                {% call viewSection() %}
                   <table>
                        <tr><td class="text-muted">{{_("Name")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.fullName" v-bind:nodatatext="notProvidedText()"></section-view>{% endraw %}</td></tr>
                        <tr><td class="text-muted">{{_("Date of Birth")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.displayBirthDate" v-bind:nodatatext="notProvidedText()"></section-view>{% endraw %}</td></tr>
                        <tr><td class="text-muted">{{_("Email")}}</td><td id="email_view">{% raw %}<section-view v-bind:data="demo.data.email" v-bind:nodatatext="notProvidedText()"></section-view>{% endraw %}</td></tr>
                        {% if person.has_role(ROLE.PATIENT.value) and not current_user.has_role(ROLE.PATIENT.value) %}<tr class="study-id-view"><td class="text-muted">{{_("Study Id")}}</td><td>{%raw%}<section-view v-bind:data="demo.data.studyId" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>{% endif %}
                        {% if person.has_role(ROLE.PATIENT.value) and not current_user.has_role(ROLE.PATIENT.value) %}<tr class="site-id-view"><td class="text-muted">{{_("Site Id")}}</td><td>{%raw%}<section-view v-bind:data="demo.data.siteId" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>{% endif %}
                        <tr><td class="text-muted">{{_("Cell")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.cellPhone" v-bind:nodatatext="notProvidedText()"></section-view>{% endraw %}</td></tr>
                        <tr><td class="text-muted">{{_("Phone (Other)")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.homePhone" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
                   </table>
                {% endcall %}
                {% call editSection() %}
                    {{profileName(person)}}
                    {{profileBirthDate(person)}}
                    {{profileEmail(person)}}
                    {% if person.has_role(ROLE.PATIENT.value) and not current_user.has_role(ROLE.PATIENT.value) %} {{profileStudyID(person)}} {% endif %}
                    {% if person.has_role(ROLE.PATIENT.value) and not current_user.has_role(ROLE.PATIENT.value) %} {{profileSiteID(person)}} {% endif %}
                    {{profilePhone(person)}}
                    {{profileAltPhone(person)}}
                {% endcall %}
                <div class="get-demo-error error-message"></div>
                <div class="put-demo-error error-message"></div>
            {% endcall %}
        </div>
    </div>
{%- endmacro %}
{% macro profileDemoDetail(person, current_user) -%}
    <div id="profileDetailContainer" class="row" data-profile-section-id="demodetail" v-show="hasOptionalCoreData()">
        <div class="col-md-12 col-xs-12">
            {% call profileSection(data_sections="detail", class="patient-detail-container") -%}
                {% call titleSection(id="patientDetailLoc") -%}
                    {% if person.id == current_user.id -%}
                        {{_("My Detail")}}
                    {%- else %}
                        {% if person.has_role(ROLE.PATIENT.value) %}
                            {{_("Patient Detail")}}
                        {%else%}
                            {{_("User Detail")}}
                        {%endif%}
                    {%- endif %}
                {%- endcall %}
                {% call viewSection() -%}
                    <table>
                        <tr class="gender-view" v-if="(getShowInMacro()).indexOf('gender') !== -1"><td class="text-muted">{{_("Gender")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.gender" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
                        <tr data-section-id="ethnicity" class="ethnicity-view optional" v-if="(getShowInMacro()).indexOf('ethnicity') !== -1"><td class="text-muted">{{_("Ethnicity")}}</td><td>{% raw %}<section-view-extension v-bind:data="demo.data.ethnicity" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
                        <tr data-section-id="race" class="race-view optional" v-if="(getShowInMacro()).indexOf('race') !== -1"><td class="text-muted">{{_("Race")}}</td><td>{% raw %}<section-view-extension v-bind:data="demo.data.race" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
                     </table>
                {%- endcall %}
                {% call editSection(class="flex") -%}
                    {{profileGender(person)|show_macro('gender')}}
                    {{profileEthnicity(person)|show_macro('ethnicity')}}
                    {{profileRace(person)|show_macro('race')}}
                {%- endcall %}
                <div class="no-data-container"></div>
                <div class="get-demo-error error-message"></div>
                <div class="put-demo-error error-message"></div>
            {%- endcall %}
        </div>
    </div>
{%- endmacro %}
{% macro profileLocaleTimeZone(person) %}
    {% call profileSection(data_sections="locale, timezone") %}
        {% call titleSection(id="timeZoneLocaleLoc") -%}{{_("Locale / Time Zone")}}{%- endcall %}
        {% call viewSection(id="profileLocaleTimezoneContainer") -%}
            <table>
                <tr class="locale-view"><td class="text-muted">{{_("Language")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.languageDisplay" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
                <tr class="timezone-view"><td class="text-muted">{{_("Time Zone")}}</td><td>{% raw %}<section-view v-bind:data="demo.data.timezone" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
            </table>
        {%- endcall %}
        {% call editSection(class="flex") -%}
            {{profileLocale(person)|show_macro('language')}}
            {{profileTimeZone(person)}}
        {%- endcall %}
        <div class="get-demo-error get-locale-error error-message"></div>
        <div class="put-demo-error error-message"></div>
    {% endcall %}
{% endmacro %}
{% macro profileBirthDate(person) -%}
    <div class="form-group profile-section" id="bdGroup" data-profile-section-id="birthday">
        <label id="birthdateLabel" class="profile-birthdate-label">{{ _("Birth Date") }}</label>
        <div class="flex">
            <div class="flex-item" id="bdDateContainer" data-loader-container="true"><input class="form-control bd-element" id="date" aria-label="{{_('Birth Date')}}" name="birthdayDate" placeholder="DD" data-birthday="true" type="text" pattern="(\d)?\d" maxlength="2" data-error="{{_('Birth date must be valid and in the required format.')}}" data-error-field="errorbirthday" autocomplete="off" data-trigger-event="change" v-model.lazy="demo.data.birthDay" v-bind:disabled="isDisableField('dob')" v-bind:required="!isDisableField('dob')"  data-protected-fieldid="dob" />
            {{saveLoaderDiv("bdDateContainer")}}
            </div>
            <div class="flex-item" id="bdMonthContainer" data-loader-container="true">
                <select class="form-control bd-element" aria-label="{{_('Birth Month')}}" name="birthdayMonth" id="month" data-error="{{_('Birth date must be valid and in the required format.')}}" data-birthday="true" data-error-field="errorbirthday" data-trigger-event="change" v-model.lazy="demo.data.birthMonth" v-bind:disabled="isDisableField('dob')" v-bind:required="!isDisableField('dob')">
                    <option value="">{{ _("Month") }}...</option>
                    <option value="01">{{ _("January") }}</option>
                    <option value="02">{{ _("February") }}</option>
                    <option value="03">{{ _("March") }}</option>
                    <option value="04">{{ _("April") }}</option>
                    <option value="05">{{ _("May") }}</option>
                    <option value="06">{{ _("June") }}</option>
                    <option value="07">{{ _("July") }}</option>
                    <option value="08">{{ _("August") }}</option>
                    <option value="09">{{ _("September") }}</option>
                    <option value="10">{{ _("October") }}</option>
                    <option value="11">{{ _("November") }}</option>
                    <option value="12">{{ _("December") }}</option>
                </select>
                {{saveLoaderDiv("bdMonthContainer")}}
            </div>
            <div class="flex-item" id="bdYearContainer" data-loader-container="true">
                <input class="form-control bd-element" id="year" name="birthdayYear" aria-label="{{_('Birth Year')}}" placeholder="YYYY" pattern = "(19|20)\d{2}" data-birthday="true" type="text" maxlength="4" data-error="{{_('Birth date must be valid and in the required format.')}}" data-error-field="errorbirthday" data-trigger-event="change" autocomplete="off" v-model.lazy="demo.data.birthYear" v-bind:disabled="isDisableField('dob')" v-bind:required="!isDisableField('dob')" data-protected-fieldid="dob"/>
                {{saveLoaderDiv("bdYearContainer")}}
            </div>
        </div>
        <div class="help-block with-errors"></div>
        <div id="errorbirthday" class="error-message"></div>
        <input type="hidden" name="birthDate" id="birthday" v-model="demo.data.birthDate"/>
     </div>
{%- endmacro %}

{% macro profileLocale(person) -%}
    <div id="localeGroup" class="form-group float-input-label profile-section timezone-container flex-item" data-loader-container="true">
        <label for="locale">{{ _("Language") }}</label>
        <select class="form-control" name="locale" id="locale" v-model="demo.data.languageCode" v-on:change="updateLocaleData">
            {%- for locale_code, locale_name in person.locale_display_options.items() -%}
                <option value="{{ locale_code }}" {{ "selected" if ((person and person.locale_code == locale_code) or ((not person or not person.locale_code) and config.get("DEFAULT_LOCALE") == locale_code)) }}>{{ _(locale_name) }}{{(" (" + _("Default") + ")") if config.get("DEFAULT_LOCALE") == locale_code }}</option>
            {%- endfor -%}
        </select>
        {{saveLoaderDiv("localeGroup")}}
        <input type="hidden" id="sys_default_locale" value="{{config.get('DEFAULT_LOCALE')}}" />
        <div class="get-demo-error get-locale-error error-message"></div>
        <div class="put-demo-error error-message"></div>
     </div>
{%- endmacro %}

{% macro profileName(person, isFocus=False) -%}
    <div class="form-group profile-name-label"><label>{{ _("Name") }}</label></div>
    <div class="row profile-section name-section" data-profile-section-id="name">
        <div id="firstNameContainer" class="col-lg-5 col-md-5 col-sm-4 col-xs-10 first-name-container" data-loader-container="true">
            <div id="firstNameGroup" class="form-group float-input-label">
                <input {{"autofocus" if isFocus}} required="required" data-error="{{ _('First name is required and must not contain invalid characters.') }}" class="form-control float-text" id="firstname" name="firstname" aria-label="{{_('First name')}}" placeholder="{{ _('First Name') }}" value="{{ person.first_name if person and person.first_name }}" type="text"  autocomplete="off" data-htmltags="true" data-error-field="errorfirstname" v-model.lazy="demo.data.name.given"/>
                <div class="help-block with-errors"></div>
                <div id="errorfirstname" class="error-message"></div>
            </div>
            {{saveLoaderDiv("firstNameContainer")}}
        </div>
        <div id="lastNameContainer" class="col-lg-5 col-md-5 col-sm-4 col-xs-10 last-name-container" data-loader-container="true">
            <div id="lastNameGroup" class="form-group float-input-label">
                <input required="required" data-error="{{ _('Last name is required and must not contain invalid characters.') }}" class="form-control float-text" id="lastname" name="lastname" aria-label="{{_('Last name')}}" placeholder="{{ _('Last Name') }}" value="{{ person.last_name if person and person.last_name }}" type="text" autocomplete="off" data-error-field="errorlastname" data-htmltags="true" v-model.lazy="demo.data.name.family"/>
                <div class="help-block with-errors"></div>
                <div id="errorlastname" class="error-message"></div>
            </div>
            {{saveLoaderDiv("lastNameContainer")}}
        </div>
    </div>
{%- endmacro %}

{% macro profileGender(person) -%}
    <div class="form-group profile-section flex-item" id="genderGroup" data-loader-container="true">
        <label id="genderLabel">{{ _("Gender") }}</label>
        <div id="profile-gender-list" class="profile-radio-list">
            <label class="radio-inline">
                <input type="radio" name="sex" id="sexM" value="male" data-save-container-id="genderGroup" v-on:click="updateGenderData" v-model="demo.data.gender" required {{ "checked" if person and person.gender == "male"}}/>
                {{ _("Male") }}
            </label>
            <label class="radio-inline">
                <input type="radio" name="sex" id="sexF" value="female" data-save-container-id="genderGroup" v-on:click="updateGenderData" v-model="demo.data.gender" required {{ "checked" if person and person.gender == "female"}}/>
                {{ _("Female") }}
            </label>
            <label class="radio-inline">
                <input type="radio" name="sex" id="sexO" value="other" data-save-container-id="genderGroup" v-on:click="updateGenderData" v-model="demo.data.gender" required {{ "checked" if person and person.gender == "other"}}/>
                {{ _("Other") }}
            </label>
        </div>
        {{saveLoaderDiv("genderGroup")}}
    </div>
{%- endmacro %}
{% macro profileRace(person) -%}
    {%- if person and person.org_coding_display_options.race -%}
        <div class="form-group profile-section flex-item optional" data-section-id="race" id="userRace" data-loader-container="true">
            <label>{{ _("Race") }}</label>
            <div class="profile-radio-list">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="1002-5" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("American Indian or Alaska Native") }}
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="2028-9" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("Asian") }}
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="2054-5" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("Black or African American") }}
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="2076-8" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("Native Hawaiian or Other Pacific Islander") }}
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="2106-3" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("White") }}
                    </label>
                </div>
                <div class="checkbox">
                    <label>
                        <input type="checkbox" name="race" value="2131-1" data-trigger-event="click" v-model="demo.data.raceCodes" v-on:click="updateExtensionData">{{ _("Other") }}
                    </label>
                </div>
            </div>
            {{saveLoaderDiv("userRace")}}
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro profileEthnicity(person) -%}
    {%- if person and person.org_coding_display_options.ethnicity -%}
        <div class="form-group profile-section flex-item optional" data-section-id="ethnicity" data-loader-container="true" id="userEthnicity">
            <label>{{ _("Ethnicity") }}</label>
            <div class="profile-radio-list">
                <div class="radio">
                    <label>
                        <input type="radio" name="ethnicity" value="2135-2" data-trigger-event="click" v-model="demo.data.ethnicityCodes" v-on:click="updateExtensionData">{{ _("Hispanic or Latino") }}
                    </label>
                </div>
                <div class="radio">
                    <label>
                        <input type="radio" name="ethnicity" value="2186-5" data-trigger-event="click" v-model="demo.data.ethnicityCodes" v-on:click="updateExtensionData">{{ _("Not Hispanic or Latino") }}
                    </label>
                </div>
            </div>
            {{saveLoaderDiv("userEthnicity")}}
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro profileEmail(person) -%}
    <div class="form-group float-input-label profile-section data-update-on-validated" id="emailGroup" data-error-field="erroremail" data-loader-container="true" data-profile-section-id="email">
        <label for="email">{{_("Email Address")}}</label>
        <input type="text" class="form-control" id="email" name="email" data-save-container-id="emailGroup" placeholder="{{ _('Email Address') }}" value="{{ person.email if person and person.email and person.email != '__no_email__' }}" data-customemail="true" data-error-field="erroremail" {% if person and person.has_role(ROLE.PATIENT.value)%}data-optional="true"{% else %}required{% endif %} />
        <div class="help-block with-errors" id="erroremail"></div>
        {{saveLoaderDiv("emailGroup")}}
    </div>
{%- endmacro %}
{% macro profileEmailForm(person, prefix='registration', status_title=_('Registration Status:'), status_label=_('not registered'), class='') -%}
    <div class="form-group well profile-email-container {{class}}" id="profile{{prefix}}SendEmailContainer" data-profile-section-id="patientemailform" data-email-type="{{prefix}}">
       <div id="{{prefix}}StatusContainer" class="{{prefix}}-status-container">
            <span class="text-muted">{{status_title}}</span>
            <!-- default display -->
            {% if not prefix or (prefix == 'registration') %}
                {% if person.is_registered() %}
                    <h4 class="registration-label text-success">{{_("registered")}}</h4>
                {% else %}
                    <h4 class="registration-label text-warning">{{_("not registered")}}</h4>
                {% endif %}
            {% else %}
                <h4 class="{{prefix}}-label text-success" v-if="patientReport.hasP3PReport">{{_("complete")}}</h4>
                <h4 class="{{prefix}}-label text-success" v-if="!patientReport.hasP3PReport">{{_("incomplete")}}</h4>
                <div v-if="patientReport.hasP3PReport"><a href='#profilePatientReportTable' class='report-link'>{{_("View reports")}}</a></div>
            {% endif %}
            <div class="email-selector-container">
                <label id="send{{prefix}}EmailLabel" class="text-muted">{{_("Send email to patient")}}</label>
                <select id="profile{{prefix}}EmailSelect" class="form-control bd-element {{prefix}}-email-selector email-selector" aria-labelledby="sendEmailLabel" v-bind:class="{disabled: !isUserEmailReady()}" v-bind:disabled="!isUserEmailReady()">
                    <option value="">{{_("Select Email...")}}</option>
                    {{caller()}}
                </select>
            </div>
        </div>
        <button id="btnProfileSend{{prefix}}Email" class="btn-send-email btn btn-tnth-primary" type="button" v-bind:class="{disabled: !isUserEmailReady()}" v-bind:disabled="!isUserEmailReady()" disabled>{{ _("Send email") }}</button>
        <div id="profile{{prefix}}EmailBtnMsgWrapper" class="profilePatientEmail__btn-msg-wrapper tnth-hide">
            <div id="profile{{prefix}}EmailLoadingIndicator" v-show="patientEmailForm.loading"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
            <div id="profile{{prefix}}EmailMessage" class="send-email-info text-info" v-html="messages.userInviteEmailInfoMessage"></div>
            <div id="profile{{prefix}}EmailErrorMessage" class="send-email-info text-danger" v-html="messages.userInviteEmailErrorMessage"></div>
        </div>
        {{emailReadyMessage()}}
    </div>
{%- endmacro %}
{% macro profileSendEmail(person) -%}
    {%- if person -%}
        <div class="email-form-container">
            {% call profileEmailForm(person) %}
                {%if not person.is_registered()%}
                    <option value="invite" data-url="{{url_for('portal.patient_invite_email', user_id=person.id)}}">{{_("TrueNTH Invite")}}</option>
                {%endif %}
                <option value="reminder" data-url="{{url_for('portal.patient_reminder_email', user_id=person.id)}}">{{_("TrueNTH Reminder")}}</option>
                <!-- reactive option, will only show when user is in ready for sub-study and email is available -->
                <option value="welcome" data-url="{{url_for('portal.patient_invite_email', user_id=person.id, research_study_id=1)}}"  :hidden="!allowSubStudyWelcomeEmail()" :disabled="!allowSubStudyWelcomeEmail()">{{_("EMPRO Welcome")}}</option>
            {% endcall %}
            <!--
                set P3P invite/reminder tile visibility based on whether user's org matches config variable, ACCEPT_TERMS_ON_NEXT_ORG - this is the case of MUSIC patient
            -->
            {% set cssClass %}{%- if person.first_top_organization() and (person.first_top_organization().name == config.ACCEPT_TERMS_ON_NEXT_ORG) -%}active{%-endif-%}{% endset %}
            {% call profileEmailForm(person, prefix='assessment', status_title=_('P3P Assessment Status:'), status_label=_('not available'), class=cssClass) %}
                <option value="invite" data-url="{{url_for('portal.patient_invite_email', user_id=person.id)}}">{{_("Initial invite to complete P3P assessment")}}</option>
                <option value="reminder" data-url="{{url_for('portal.patient_reminder_email', user_id=person.id)}}">{{_("Reminder to complete P3P assessment")}}</option>
            {% endcall %}
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro profileStaffRegistrationEmail(person) -%}
    {%- if person -%}
    <div id="sendRegistrationEmailForm" data-profile-section-id="staffemailform">
        <input type="hidden" name="_userId" id="_userId" value="{{person.id}}" />
        <div class="registration-status-container">
            <span class="text-muted">{{_('Registration status:')}}</span>
            {% if person.is_registered() %}
                <h4 class="text-success registration-label">{{_('registered')}}</h4>
            {%- else -%}
                <h4 class="text-warning registration-label">{{_("not yet registered")}}</h4>
            {%- endif -%}
        </div>
        <div class="buttons-container">
            <div class="loading-indicator invisible"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
            <button id="btnProfileSendEmail" class="btn btn-tnth-primary sm-btn btn-send-email" v-bind:class="{disabled: !isUserEmailReady()}" v-bind:disabled="!isUserEmailReady()">{{ _("Send email") }}</button>
        </div>
        <div id="profileEmailMessage" class="text-info"></div>
        <div id="profileEmailErrorMessage" class="text-danger"></div>
        {{emailReadyMessage()}}
        <input type="hidden" id="staffRegistrationEmailUrl" value="{{url_for('staff.staff_registration_email', user_id=person.id)}}" />
    </div>
    {%- endif -%}
{%- endmacro %}
{% macro profileCommunications(person, current_user) -%}
    {%- if person and person.has_role(ROLE.PATIENT.value) and (current_user and current_user.has_role(ROLE.STAFF.value, ROLE.STAFF_ADMIN.value, ROLE.CLINICIAN.value, ROLE.ADMIN.value, ROLE.INTERVENTION_STAFF.value)) -%}
        {%- if current_user.has_role(ROLE.CLINICIAN.value) -%}
            <div class="row">
                <div class="col-md-12 col-xs-12">
                    <div class="profile-item-container" data-profile-section-id="communication">
                        <h4 id="communicationsLoc" class="profile-item-title index-item">{{ _("Communications") }}</h4>
                        <p class="communication-title text-muted singleton">{{_("Email audit log")}}</p>
                        {{profileEmailLog(person)}}
                    </div>
                </div>
            </div>
        {%- else -%}
            <div class="row">
                <div class="col-md-12 col-xs-12">
                    <div class="profile-item-container" data-profile-section-id="communication">
                        <h4 id="communicationsLoc" class="profile-item-title index-item">{{ _("Communications") }}</h4>
                        <div id="communicationsContainer" class="tabs-container">
                            {% if person.is_registered() %}
                                <div class="tab">
                                <input id="tab-one" name="tabGroup" type="radio" data-validate="false" class="tab-input">
                                <label for="tab-one" class="tab-label">{{_("Send reset password email to patient")}}</label>
                                <div class="tab-content">
                                {{resetPassword(person)}}
                                </div>
                                </div>
                            {% endif %}
                            {%- if not config.CUSTOM_PATIENT_DETAIL -%}
                                <div class="tab">
                                <input id="tab-two" name="tabGroup" type="radio" data-validate="false" class="tab-input">
                                <label id="lbPatientRegEmail" for="tab-two" class="tab-label {% if not person.is_registered()%}active{%endif %}">{{_("Send invitation and reminder emails to patient")}}</label>
                                <div id="sendPatientEmailTabContent" class="tab-content send-email-tab-content">
                                    {{profileSendEmail(person)}}
                                </div>
                                </div>
                            {%- endif %}
                            <div class="tab">
                            <input id="tab-three" name="tabGroup" type="radio" data-validate="false" class="tab-input">
                            <label id="lbEmailLog" for="tab-three" class="tab-label">{{_("Email audit log")}}</label>
                            <div class="tab-content">
                                {{profileEmailLog(person)}}
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {%- endif -%}

    {%- elif person and person.has_role(ROLE.CLINICIAN.value, ROLE.STAFF.value, ROLE.STAFF_ADMIN.value) -%}
        <div class="row">
            <div class="col-md-12 col-xs-12">
                <div class="profile-item-container" data-profile-section-id="communication">
                    <h4 id="communicationsLoc" class="profile-item-title index-item">{{ _("Communications") }}</h4>
                    <div id="communicationsContainer" class="tabs-container">
                        <div class="tab">
                            <input id="tab-five" name="tabGroup" type="radio" data-validate="false" class="tab-input">
                            {%- if person.is_registered() -%}
                                <label id="lbStaffResetPassword" for="tab-five" class="tab-label">{{_("Send reset password email to staff")}}</label>
                                <div class="tab-content">
                                    <!-- reset password -->
                                    {{resetPassword(person)}}
                                </div>
                            {%- else -%}
                                <label id="lbStaffRegEmail" for="tab-five" class="tab-label">{{_("Send registration email to user")}}</label>
                                <div class="tab-content">
                                    <!-- registration -->
                                    {{profileStaffRegistrationEmail(person)}}
                                </div>
                            {%- endif -%}
                        </div>
                        <div class="tab">
                            <input id="tab-six" name="tabGroup" type="radio" data-validate="false" class="tab-input">
                            <label id="lbEmailLog" for="tab-six" class="tab-label">{{_("Email audit log")}}</label>
                            <div class="tab-content">
                                {{profileEmailLog(person)}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro profileEmailLog(person) -%}
    <div id="emailLogContainer">
        <div id="emailLogContent"><span class="text-muted">{{_("None available")}}</span></div>
        <div id="emailLogMessage" class="error-message"></div>
    </div>
    <div class="modal fade" id="emailBodyModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <div class="modal-header-title">{{_("Email Message Content")}}</div>
            </div>
            <div class="modal-body">
                <div class="body-content"></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">{{_("Close")}}</button>
            </div>
          </div>
        </div>
    </div>
{%- endmacro %}

{% macro profilePhone(person) -%}
    <div id="phoneGroup" class="form-group float-input-label profile-section" data-loader-container="true" data-profile-section-id="phone">
        <label for="phone">{{_("Cell")}} <span class="text-muted smaller-text optional-display-text">({{_("Optional")}})</span></label>
        <input type="text" class="form-control" id="phone" name="phone" value="{{ person.phone if person and person.phone }}"  pattern="^[0-9]*$"  data-error="{{_('Phone number must be in numbers.')}}" data-htmltags="true" data-error-field="errorphone" v-on:change="updateTelecomData" v-model.lazy="demo.data.cellPhone"/>
        <div class="help-block with-errors"></div>
        {{saveLoaderDiv("phoneGroup")}}
    </div>
    <div id="errorphone" class="error-message"></div>
{%- endmacro %}

{% macro profileAltPhone(person) -%}
    <div id="altPhoneGroup" class="form-group float-input-label profile-section" data-loader-container="true" data-profile-section-id="altphone">
        <label for="altPhone">{{_("Phone (Other)")}} <span class="text-muted smaller-text optional-display-text">({{_("Optional")}})</span></label>
        <input type="text" class="form-control" id="altPhone" name="altPhone" value="{{ person.alt_phone if person and person.alt_phone }}" pattern="^[0-9]*$" data-error="{{_('Phone number must be in numbers.')}}" data-htmltags="true" data-error-field="erroraltPhone" v-on:change="updateTelecomData" v-model.lazy="demo.data.homePhone"/>
        <div class="help-block with-errors"></div>
        <div id="erroraltPhone" class="error-message"></div>
        {{saveLoaderDiv("altPhoneGroup")}}
    </div>
{%- endmacro %}

{% macro resetPassword(person) %}
    <div id="resetPasswordGroup" class="form-group" data-profile-section-id="resetpassword">
        <button id="btnPasswordResetEmail" class="btn btn-tnth-primary sm-btn">{{_("Send email")}}</button>
        <div class="loading-indicator tnth-hide"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
        <div id="passwordResetMessage" class="text-info"></div>
        <div id="passwordResetErrorMessage" class="error-message"></div>
    </div>
{%-endmacro %}

{% macro profileOrgsSelector(person, current_user, consent_agreements) -%}
    {% call viewSection(id="userOrgs_view") -%}
        <div v-html="getOrgsDisplay()"></div>
    {%- endcall %}
    {% call editSection() -%}
        <div id="clinics" data-loader-container="true" data-profile-section-id="orgsstateselector" data-save-container-id="clinics">
            <div id="userOrgs" class="customized">
               <input type="hidden" id="stock_consent_url" value="{{ url_for('portal.stock_consent', org_name='placeholder', _external=True)}}" />
               <p class="prompt">
                {% if current_user and current_user.has_role(ROLE.STAFF.value, ROLE.STAFF_ADMIN.value) %}
                    {{_("In what state is the patient currently receiving prostate cancer care?")}}
                {% else %}
                    {{_("In what state are you currently receiving prostate cancer care?")}}
                {% endif %}
               </p>
               <div class="state-selector-container selector-show">
                    <select id="stateSelector" class="form-control"></select>
                </div>
               <div id="fillOrgs" userId="{{person.id if person}}" class="orgs-by-state" {%if person and person.has_role(ROLE.PATIENT.value) and person.id == current_user.id %}patient_view="true"{%endif%}>
                   <p class="clinic-prompt prompt selector-show">{{_("What is your main clinic for prostate cancer care?")}}</p>
                   <div class="main-state-container selector-show"></div>
               </div>
                <div class="noOrg-container" style="display: none">
                    <label>
                        <input id="noOrgs" class="clinic" type="radio" name="organization" value="0" />
                        <span>{{_("None of the Above")}}</span>
                    </label>
                </div>
               <div id="userOrgsInfo" class="text-muted selector-show">{{_("No clinic found in selected state.")}}</div>
               <div id="defaultConsentContainer"></div>
               <div>{{default_consent_modal()}}</div>
               {% if consent_agreements %}{{consent(person, consent_agreements, current_user, True)}}{% endif %}
            </div>
        </div>
        {{saveLoaderDiv("clinics")}}
    {%- endcall %}
    <div class="get-orgs-error error-message"></div>
    <div class="get-demo-error error-message"></div>
    <div class="put-demo-error error-message"></div>
{%- endmacro %}
<!--this has an ajax call to fill in the content-->
{% macro profileOrg(person, consent_agreements, current_user) -%}
    {% call viewSection(id="userOrgs_view") -%}
        <div v-html="getOrgsDisplay()"></div>
    {%- endcall %}
    {% call editSection() %}
        <div id="clinics" data-profile-section-id="orgs" data-save-container-id="clinics">
            <div class="form-group profile-section standard" id="userOrgs">
                {% if 'patient' in config.CONSENT_EDIT_PERMISSIBLE_ROLES and person.has_role(ROLE.PATIENT.value) %}<p class="text-muted">{{_("Main clinic for prostate cancer care")}}</p>{%else%}
                <label>{{_("Clinics")}} <span class="text-muted smaller-text optional-display-text">({{_("Optional")}})</span></label>{% endif %}
                <div class="indent">
                <input type="hidden" id="stock_consent_url" value="{{ url_for('portal.stock_consent', org_name='placeholder', _external=True)}}">
                <div id="fillOrgs" {% if person and person.has_role(ROLE.PATIENT.value) and person.id == current_user.id %}patient_view="true"{%endif%}></div>
                {%- if person and person.has_role(ROLE.STAFF.value, ROLE.STAFF_ADMIN.value) -%}
                    <!-- nothing to do -->
                {%- else -%}
                    <div class="noOrg-container"><label><input id="noOrgs" class="clinic" type="checkbox" name="organization" value="0"><span>{{_("None of the Above")}}</span></label></div>
                {%- endif -%}
                </div>
                <div id="defaultConsentContainer" data-profile-section-id="consent"></div>
                <div>{{default_consent_modal()}}</div>
                {% if consent_agreements %}{{consent(person, consent_agreements, current_user)}} {% endif %}
                <div class="help-block with-errors"></div>
            </div>
        </div>
        {{saveLoaderDiv("clinics")}}
    {% endcall %}
    <div class="get-orgs-error error-message"></div>
    <div class="get-demo-error error-message"></div>
    <div class="put-demo-error error-message"></div>
{%- endmacro %}
{% macro default_consent_modal() -%}
    {% raw %}
        <div class="modal fade" id="defaultConsentModal" tabindex="-1" role="dialog" aria-labelledby="defaultConsentModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="{close}"><span aria-hidden='true'>&times;</span></button>
                        <h4 class="modal-title">{title}</h4>
                    </div>
                    <div class="modal-body">
                        <div class="content-loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
                        <div class="main-content tnth-hide">
                            <p>{consentText}</p>
                            <div id="{orgId}defaultConsentAgreementRadioList" class="profile-radio-list">
                                <label class="radio-inline"><input type="radio" name="toConsent" id="{orgId}_consent_yes" data-org="{orgId}" value="yes"/>{yes}</label>
                                <br/>
                                <label class="radio-inline"><input type="radio" name="toConsent" id="{orgId}_consent_no" data-org="{orgId}"  value="no"/>{no}</label>
                            </div>
                        </div>
                        <div id="{orgId}_consentAgreementMessage" class="set-consent-error error-message"></div>
                    </div>
                    <br/>
                    <div class="modal-footer" >
                        <div id="{orgId}_loader" class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
                        <button type="button" class="btn btn-default btn-consent-close" data-org="{orgId}" data-dismiss="modal" aria-label="{close}">{close}</button>
                    </div>
                </div>
            </div>
        </div>
    {% endraw %}
{%- endmacro %}
{% macro consent_modal(person, consent_agreement, org) -%}
    {%- if person and consent_agreement and org -%}
        <div class="modal fade consent-modal" id="{{org}}_consentModal" tabindex="-1" role="dialog" aria-labelledby="{{org}}_consentModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">{{ _("Consent to share information") }}</h4>
                    </div>
                    <div class="modal-body">
                        <div class="content-loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
                        <div class="main-content tnth-hide">
                            <div class="terms-wrapper">
                                <h4>Terms</h4>
                                <div class="terms-container">{{consent_agreement.asset|safe}}</div>
                            </div>
                            <input type="hidden" class="agreement-url" value="{{consent_agreement.url|safe}}" />
                            <br/>
                            <p>
                                {% trans org_shortname=consent_agreement.organization_shortname %}
                                    I consent to sharing information with <span class="consent-clinic-name">{{org_shortname}}</span>.
                                {% endtrans %}
                            </p>
                            <div id="{{org}}_consentAgreementRadioList" class="profile-radio-list">
                              <label class="radio-inline"><input type="radio" name="toConsent" id="{{org}}_consent_yes" data-org="{{org}}" value="yes"/>{{ _("Yes") }}</label>
                              <br/>
                              <label class="radio-inline"><input type="radio" name="toConsent" id="{{org}}_consent_no" data-org="{{org}}"  value="no"/>{{ _("No") }}</label>
                            </div>
                        </div>
                        <div id="{{org}}_consentAgreementMessage" class="set-consent-error error-message"></div>
                     </div>
                     <br/>
                     <div class="modal-footer" >
                        <div id="{{org}}_loader" class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i></div><button type="button" class="btn btn-default btn-consent-close" data-org="{{org}}" data-dismiss="modal" aria-label="Close">{{ _("Close") }}</button>
                     </div>
                </div>
            </div>
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro consent(person, consent_agreements, current_user, includeModal) -%}
    {%- if person and consent_agreements -%}
        <div id="consentContainer" data-profile-section-id="consent">
            {{consent_fields(consent_agreements, current_user)}}
            {%- if includeModal-%}
                {%- for org in consent_agreements -%}
                   {%- if consent_agreements[org].url and consent_agreements[org].asset -%}
                   {{consent_modal(person, consent_agreements[org], org)}}
                   {%- endif -%}
                {%- endfor -%}
            {%- endif -%}
            <div class="get-consent-error error-message"></div>
        </div>
    {%- endif -%}
{%- endmacro %}
{% macro patientReports(person) -%}
    <div class="row" id="patientReportsContainer">
        <div class="col-md-12 col-xs-12">
        {% call profileSection(editable=False) -%}
            {% call titleSection(id="patientReportsLoc") -%}{{ _("Patient Reports") }}{%-endcall %}
            <input type="hidden" id="pr_user_id" value="{{person.id}}"/>
            <div id="prTableToolBar"><span id="tableCount"></span></div>
            <a href="#profilePatientReportTable"></a>
            <table id="profilePatientReportTable" data-profile-section-id="patientreport"></table>
            <div id="patientReportErrorMessage" class="text-muted"></div>
        {%- endcall %}
        </div>
    </div>
{%- endmacro %}

{% macro profileConsent(person, current_user) -%}
    {% if person %}
        <div id="profileConsentList">
            <div id="consentListLoad" v-show="consent.consentLoading"><i class="fa fa-spinner fa-spin fa-2x loading-message"></i></div>
            <div v-if="!hasCurrentConsent()" class="text-muted">{{_("No consent record found")}}</div>
            {% raw %}
                <div id="consentListErrorMessageContainer" class="error-message">{{consent.consentListErrorMessage}}</div>
            {% endraw %}
            <table id='consentListTable' class='table-bordered table-condensed table-responsive' v-show="hasCurrentConsent()">
                <THEAD>
                    <TH v-for="item in consent.consentHeaderArray" v-html="item" class="consentlist-header"></TH>
                </THEAD>
                <TBODY>
                    {% raw %}
                        <tr v-for="item in consent.touObj" v-bind:class="{'tnth-hide': !consent.showInitialConsentTerms}" v-bind:data-tou-type="item.type">
                            <td class="consentlist-cell"><span class="eproms-tou-table-text">{{item.name}}</span><span class="truenth-tou-table-text">{{item.truenth_name}}</span></td>
                            <td class="consentlist-cell">
                                <span class="text-success small-text eproms-tou-table-text"><a v-bind:href="item.agreement_url" target="_blank">{{item.eproms_agreement_text}}</a></span>
                                <span class="text-success small-text truenth-tou-table-text">{{item.truenth_agreement_text}}</span>
                            </td>
                            <td class="consentlist-cell">
                                <span class="eproms-tou-table-text text-capitalize agreement"><a v-bind:href="item.agreement_url" target="_blank">{{item.eproms_url_text}}</a></span>
                                <span class="truenth-tou-table-text">
                                    {{item.truenth_url_text}}
                                    <span>&nbsp;<a v-bind:href="item.agreement_url" target="_blank"><em>{{item.view}}</em></a></span>
                                </span>
                            </td>
                            <td class="consentlist-cell">{{item.accepted}}</td>
                        </tr>
                        <tr v-for="row in consent.consentDisplayRows" v-if="consent.consentDisplayRows">
                            <td class="consentlist-cell" v-bind:class="item._class" v-html="item.content" v-for="item in row"></td>
                        </tr>
                    {% endraw %}
                </TBODY>
            </table>
        </div>
        <div id="profileConsentHistory" v-show="showConsentHistory()">
            <br/><button id="viewConsentHistoryButton" class='btn btn-tnth-primary sm-btn tnth-hide'>{{_("History")}}</button>
            <div class="modal fade" id="consentHistoryModal" tabindex="-1" role="dialog" aria-labelledby="consentHistoryModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title">{{_("Consent History")}}</h4>
                        </div>
                        <div class="modal-body"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default btn-consent-close" data-dismiss="modal" aria-label="Close">{{_("Close")}}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
         <div class="modal fade" id="profileConsentListModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="{{_('Close')}}"><span aria-hidden="true">&times;</span></button>
                            <h5 class="modal-title">{{_("Consent Status Editor")}}</h5>
                        </div>
                        <div class="modal-body">
                            <h4>{{_("Modify the consent status for this user to")}}</h4>
                            <div class="radio">
                                <label>
                                    <input class="radio_consent_input" name="radio_consent" type="radio" value="consented" data-orgId="" data-agreementUrl="" data-userId="" data-researchStudyId="0">{{_("Consented / Enrolled")}}</input>
                                </label>
                            </div>
                            <div class="radio">
                                <label class="text-warning">
                                    <input class="radio_consent_input" name="radio_consent" type="radio" value="suspended" data-orgId="" data-agreementUrl="" data-userId="" data-researchStudyId="0">
                                        <span class="withdrawn-label">
                                            <span data-eproms='true'>{{_("Withdrawn - Suspend Data Collection and Report Historic Data")}}</span>
                                            <span data-truenth='true'>{{_("Suspend Data Collection and Report Historic Data")}}</span>
                                        </span>
                                    </input>
                                </label>
                            </div>
                            <div class="radio admin-radio tnth-hide">
                                <label class="text-danger">
                                    <input class="radio_consent_input" name="radio_consent" type="radio" value="purged" data-orgId="" data-agreementUrl="" data-userId="" data-researchStudyId="0">{{_("Purged / Removed")}}</input>
                                </label>
                            </div>
                            <div id="#profileConsentListModalErrorMessage" class="text-danger"></div>
                        </div>
                        <div class="modal-footer">
                            <div class="content-loading-message-indicator" v-show="consent.saveLoading"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
                            <button type="button" class="btn btn-default" data-dismiss="modal" v-show="!consent.saveLoading">{{_("Close")}}</button>
                        </div>
                </div>
            </div>
        </div>
        <div class="modal fade consent-date-modal" id="consentDateModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="{{_('Close')}}"><span aria-hidden="true">&times;</span></button>
                        <h5 class="modal-title">{{_("Consent Date Editor")}}</h5>
                    </div>
                    <div class="modal-body">
                        <h4><span>{{_("Current consent date: ")}}&nbsp;</span>
                            <span class="text-success data-current-consent-date"></span></h4>
                        <p>{{_("Modify the consent date")}} <span class="text-muted">{{_("GMT 24-hour format")}}</span>  <span>{{_("for this agreement to:")}}</p>
                        <div id="consentDateLoader" class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i></div>
                        <div id="consentDateContainer" class="form-group consent-date-container">
                            <div class="row">
                                <div class="col-md-4 col-sm-3 col-xs-3">
                                    <input type="text" id="consentDateModal_date" class="form-control consent-date" data-status="" data-orgId="" data-agreementUrl="" data-userId="" placeholder="d M yyyy" maxlength="11"/>
                                </div>
                                <div class="col-md-2 col-sm-2 col-xs-3">
                                    <input type="text" id="consentDateModal_hour" maxlength="2" placeholder="hh" class="form-control consent-hour"/>
                                </div>
                                <div class="col-md-2 col-sm-2 col-xs-3">
                                    <input type="text" id="consentDateModal_minute" maxlength="2" placeholder="mm" class="form-control consent-minute"/>
                                </div>
                                <div class="col-md-2 col-sm-2 col-xs-3">
                                    <input type="text" id="consentDateModal_second" maxlength="2" placeholder="ss" class="form-control consent-second"/>
                                </div>
                            </div>
                        </div>
                        <div id="consentDateModalError" class="set-consent-error error-message"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-submit">{{_("Submit")}}</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">{{_("Close")}}</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="get-consent-error error-message"></div>
        <div class="set-consent-error error-message"></div>
        <div class="delete-consent-error error-message"></div>
    {% endif %}
{%- endmacro %}
{% macro profileConsentDate() -%}
 <div id="consentDateEditContainer">
    <div class="form-group">
        <label>{{ app_text('consent date label')}}</label>
        <input type="hidden" name="consentDate" id="consentDate" value="" />
        <div class="flex">
            <div class="flex-item">
                <input class="form-control" id="consentDay" name="consentDay" placeholder="DD" type="text" pattern="(\d)?\d" maxlength="2" data-error="{{_('Date must be valid and in the required format.')}}" autocomplete="off" required />
            </div>
            <div class="flex-item">
                <select class="form-control" name="consentMonth" id="consentMonth" data-error="{{_('Date must be valid and in the required format.')}}" required>
                    <option value="">{{ _("Month") }}...</option>
                    <option value="01">{{ _("January") }}</option>
                    <option value="02">{{ _("February") }}</option>
                    <option value="03">{{ _("March") }}</option>
                    <option value="04">{{ _("April") }}</option>
                    <option value="05">{{ _("May") }}</option>
                    <option value="06">{{ _("June") }}</option>
                    <option value="07">{{ _("July") }}</option>
                    <option value="08">{{ _("August") }}</option>
                    <option value="09">{{ _("September") }}</option>
                    <option value="10">{{ _("October") }}</option>
                    <option value="11">{{ _("November") }}</option>
                    <option value="12">{{ _("December") }}</option>
                </select>
            </div>
            <div class="flex-item">
                <input class="form-control" id="consentYear" name="consentYear" placeholder="YYYY" pattern = "(19|20)\d{2}" type="text" maxlength="4" data-error="{{_('Date must be valid and in the required format.')}}" autocomplete="off" required />
            </div>
        </div>
        <div class="help-block with-errors"></div>
        <span id="errorConsentDate" class="help-block error-message"></span>
    </div>
</div>
{%- endmacro %}
{% macro profileAuditLog(person, current_user) -%}
    {% if (person and current_user) and current_user.has_role(ROLE.ADMIN.value, ROLE.STAFF_ADMIN.value, ROLE.STAFF.value, ROLE.INTERVENTION_STAFF.value) %}
        <input type="hidden" id="audit_user_id" value="{{person.id}}"/>
        <div id="auditTableToolBar" data-profile-section-id="auditlog"></div>
        <table id="profileAuditLogTable" class="smaller-text"></table>
        <div id="profileAuditLogErrorMessage" class="error-message"></div>
     {% endif %}
{%- endmacro %}

{% macro profileRole(person, current_user) -%}
    <h4 class="text-muted">{% if person and person.username %}{{ _("for") + " " + person.username }} {% endif %}</h4>
    {% if current_user and current_user.has_role(ROLE.ADMIN.value) %}
        <p class="small-text text-muted">{{ _("Editable by admins only.") }}</p>
    {% endif %}
    <!-- roles are populated in main.js -->
    <div class="form-group" id="rolesGroup" data-profile-section-id="roleslist" v-show="roles.data.length > 0" data-loader-container="true">
        <div class='checkbox' v-for="item in roles.data">
            {% raw %}
                <!-- pre-registration roles e.g. write-only roles are not visible for editing on UI -->
                <label :class="{hide:isAdminOnlyEditableRole(item.name)}"><input type="checkbox" name="user_type" v-bind:value="item.name" data-save-container-id="rolesGroup" v-on:click="updateRolesData" :class="{hide:isAdminOnlyEditableRole(item.name)}">{{item.display_name}}</label>
            {% endraw %}
        </div>
    </div>
    {{saveLoaderDiv("rolesGroup")}}
    <div class="get-roles-error error-message"></div>
    <div class="put-roles-error error-message"></div>
    <div class="delete-roles-error error-message"></div>
{%- endmacro %}
{%- macro longitudinalReport(person) -%}
    {% call profileSection(editable=false, id="longitudinalReportSection") %}
        {% call titleSection(id="longitudinalReportsLoc") -%}{{ _("IRONMAN EMPRO Longitudinal Report") }}{%-endcall %}
        <p class="body-content text-muted">{{_("This report shows the patient's questionnaire responses over time and indicates their areas of distress. Please check for any actions required on your behalf.")}}</p>
        <div id="longitudinalReportContainer" class="eproms-substudy" data-profile-section-id="longitudinalReport">
            <!-- populate dynamically based on whether there is longitudinal report available for the subject -->
        </div>
    {% endcall %}
{%- endmacro -%}
{%- macro postInterventionQuestionnaire(person) -%}
<!-- require a static bookmark link for post intervention questionnaire section for the dynamically generated content. Othewise the hash location won't go to the section correctly -->
<a href="#postInterventionQuestionnaireLoc"></a>
<div id="postInterventionQuestionnaireLoc">&nbsp;</div>
<div class="row" id="postInterventionQuestionnaireSection" class="eproms-substudy" v-show="shouldShowPostTxQuestionnaireSection()">
    <div class="col-md-12 col-xs-12">
        {% call profileSection(editable=false) %}
        {% call titleSection() -%}{{_("EMPRO Intervention Report")}}{%- endcall %}
            <div id="postTxQuestionnaireContainer" class="eproms-substudy" data-profile-section-id="postTxQuestionnaire">
                <div class="loader" v-show="postTxQuestionnaire.loading"><i class="fa fa-spinner fa-spin fa-2x icon"></i></div>
                <!-- display trigger areas if indicated -->
                <div id="triggersSection" v-if="hasSubStudyTriggers()">
                    <h5 class="muted" v-show="!isSubStudyTriggersResolved()">{{_("Actions Required (for Clinicians/Site Staff)")}}</h5>
                    <div class="item">{{_("EMPRO questionnaire completed on:")}} <span class="text" v-html="subStudyTriggers.displaydate"></span></div>
                    <div class="item">{{_("ACTION REQUIRED for high distress areas:")}}
                        <ul class="list">
                            <li v-for="item in subStudyTriggers.domains" v-text="item.replace(/_/g, ' ')" class="text"></li>
                        </ul>
                    </div>
                </div>
                <!-- no triggers indicated -->
                <!-- show the last completed EMPRO date && indicate no triggers -->
                <div v-else>
                    <div id="noTriggersSection">
                        <div class="item">
                            <span class="text" v-text="getSubStudyAssessmentStatusDisplay()"></span>
                            <span class="text" v-text="getLastSubStudyAssessmentDate()"></span>
                        </div>
                        <!-- IF no triggers are indicated, ONLY display as such for assessment that has been COMPLETED, as triggers aren't calculated yet for assessment still in progress -->
                        <div class="item text-muted" v-show="isSubStudyAssessmentCompleted()">{{_("No high distress areas indicated")}}</div>
                    </div>
                </div>
                <div id="reportNoteSection">{{_("View subject EMPRO report for more information")}}</div>
                <!--
                    post intervention questionnaire section
                    NOTE:
                    will display triggers when present in the last determined trigger state
                    will be in a disabled state if the action state is "completed" or intervention_qnr_eligible flag is set to false
                -->
                <div id="questionsSection" class="content" :class="{disabled: shouldDisableSubstudyPostTx(), active: shouldShowSubstudyPostTx()}" v-show="shouldShowSubstudyPostTx()">
                    <div class="question" v-for="item in postTxQuestionnaire.questions" :linkId="item.linkId" :dataType="item.type" :text="item.text" >
                        <!-- question text -->
                        <span class="title" :class="item.type" v-text="item.text"></span>
                        <!-- date type answer-->
                        <input type="text" class="data-datepicker form-control answer" readonly placeholder="DD MMM YYYY"
                                :class="{disabled: isSubStudyTriggersResolved()}"
                                :dataType="item.type"
                                :linkId="item.linkId"
                                @change="onResponseChangeFieldEvent"
                                v-if="item.type == 'date'"
                        >
                        <!-- boolean type answer-->
                        <input type="checkbox"
                            class="bool answer"
                            :dataType = "item.type"
                            :linkId="item.linkId"
                            @change="onResponseChangeFieldEvent"
                            v-if="item.type == 'boolean'">
                        <!-- open-choice (checkboxes) type answer -->
                        <div class="choices answer" v-if="item.type == 'open-choice'">
                            <div class="choice" v-for="option in item.option">
                                <input
                                    type="checkbox"
                                    :code="option.valueCoding.code"
                                    :class="{other: /other/gi.test(option.valueCoding.display)}"
                                    :dataType="item.type"
                                    :linkId="item.linkId"
                                    :value="option.valueCoding.display"
                                    @change="onResponseChangeFieldEvent"
                                >
                                <span class="text" v-text="option.valueCoding.display"></span>
                                <textarea
                                    class="form-control addl-text other-text"
                                    dataType="string"
                                    :code="option.valueCoding.code"
                                    :linkId="item.linkId"
                                    @change="onResponseChangeFieldEvent"
                                    v-if="/other/gi.test(option.valueCoding.display)"
                                ></textarea>
                            </div>
                        </div>
                        <!-- choice (select) type answer -->
                        <select class="form-control answer" v-if="item.type == 'choice'"
                            :linkId="item.linkId"
                            :dataType="item.type"
                            @change="onResponseChangeFieldEvent"
                        >
                            <option value="">{{_("Select")}}</option>
                            <option v-for="option in item.option"
                                :code="option.valueCoding.code"
                                :dataType="item.type"
                                :linkId="item.linkId"
                                :value="option.valueCoding.display"
                                v-text="option.valueCoding.display"></option>
                        </select>
                    </div>
                    <div class="footer-container">
                        <div id="postTxSubmitContainer" class="buttons-container" v-show="!isSubStudyTriggersResolved()">
                            <button class="btn-submit btn btn-tnth-primary disabled" @click="submitPostTxQuestionnaire">{{_("Submit")}}</button>
                        </div>
                        {{saveLoaderDiv("postTxSubmitContainer")}}
                        <div id="postTxResolutionContainer" v-show="isSubStudyTriggersResolved()"></div>
                    </div>
                </div>
                <!-- indicate missed action status if triggers are present -->
                <div class="action-status" v-show="hasMissedPostTxAction()">
                    <span>{{_("Action status:")}}</span>
                    <span class="text error-message" v-text="getPostTxActionStatus()"></span>
                </div>
                <div class="study-error error-message" v-show="shouldDisableSubstudyPostTx() && hasPostTxQuestionnaireErrors()">
                    <span class="glyphicon glyphicon-alert warning icon" aria-hidden="true"></span>
                    <span v-html="getSubStudyStatusErrors()" ></span>
                </div>
                <div class="post-intervention-questionnaire-error error-message"></div>
            </div>
        {% endcall %}
    </div>
  </div>
{%- endmacro -%}
{% macro profileTreatingClinician(person) %}
<div class="row" id="treatingCliniciansSection" class="eproms-substudy" v-show="isSubStudyPatient()">
    <div class="col-md-12 col-xs-12">
        {% call profileSection(data_sections="locale, timezone") %}
        {% call titleSection(id="treatingCliniciansLoc") -%}{{_("Treating Clinician")}}{%- endcall %}
        {% call viewSection(id="profileTreatingCliniciansViewContainer") -%}
            <table>
                <tr class="clinicians-view"><td>{% raw %}<section-view v-bind:data="getSelectedCliniciansDisplays()" v-bind:nodatatext="notProvidedText()"></section-view>{%endraw%}</td></tr>
            </table>
        {%- endcall %}
        {% call editSection() -%}
            <div id="treatingClinicianContainer" class="eproms-substudy" data-profile-section-id="treatingclinician">
                <div class="select-list"></div>
                {% raw %}
                    <div class="chips-list" v-if="selectedClinicians.length">
                        <span class="chip clinician-item" v-for="(item, index) in selectedClinicians" :key="item.reference + index" :dataValue="item.reference" @click="removeClinicianEvent" :id="item.reference + '_chip'"
                        >
                            <span class="chip-content">
                                <!-- delete botn is not shown for PI -->
                                <button type="button" class="chip-icon" v-show="!isPI(item.reference)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" role="img" aria-hidden="true" class="v-icon__svg"><path d="M12,2C17.53,2 22,6.47 22,12C22,17.53 17.53,22 12,22C6.47,22 2,17.53 2,12C2,6.47 6.47,2 12,2M15.59,7L12,10.59L8.41,7L7,8.41L10.59,12L7,15.59L8.41,17L12,13.41L15.59,17L17,15.59L13.41,12L17,8.41L15.59,7Z"></path></svg>
                                </button>
                                <span v-text="item.display"></span>
                                <span class="decorator-text" v-if="isPI(item.reference)" v-text="getPIIndicatorText()"></span>
                            </span>
                        </span>
                    </div>
                {% endraw %}
                <div class="select-list-error error-message"></div>
            </div>
            {{saveLoaderDiv("treatingClinicianContainer")}}
        {%- endcall %}
            <div class="put-demo-error error-message"></div>
            <div class="get-clinicians-error error-message"></div>
        {% endcall %}
    </div>
</div>
{%- endmacro %}
{% macro profileSessionList(person, current_user) -%}
    <div id="userSessionsListContainer" data-profile-section-id="assessmentlist">
        <input type="hidden" id="_session_user_id" value="{{person.id if person}}"/>
        <div id="assessmentListMessage" class="text-muted" v-show="assessment.assessmentListItems.length == 0"></div>
        <table id="userSessionListTable" class="tnth-admin-table table table-hover table-condensed table-striped table-bordered table-responsive small-text" v-if="assessment.assessmentListItems.length > 0">
            <caption>{{_("Session History")}} <span class="text-muted smaller-text">({{_("click each row to review report")}})</span></caption>
            <THEAD><th>{{_("Questionnaire Name")}}</th><th>{{_("Visit")}}</th><th>{{_("Status")}}</th><th>{{_("Last Updated")}} <small id="gmtText" class="gmt">({{ _("GMT, Y-M-D") }})</small></th></THEAD>
            {% raw %}
                <tr v-for="item in assessment.assessmentListItems" v-bind:title="item.title" v-bind:class="item.class">
                    <td><a v-bind:href="item.link" v-html="item.display"></a></td>
                    <td><a v-bind:href="item.link" v-html="item.visit"></a></td>
                    <td><a v-bind:href="item.link">{{item.status}}</a></td>
                    <td><a v-bind:href="item.link">{{item.date}}</a></td>
                </tr>
            {% endraw %}
        </table>
        {% raw %}
            <div id="profileSessionListError" class="error-message">{{assessment.assessmentListError}}</div>
        {% endraw %}
        <!-- testing feature -->
        {% if config["SYSTEM_TYPE"].lower() != "production" and (current_user.has_role(ROLE.ADMIN.value) or current_user.has_role(ROLE.STAFF_ADMIN.value)) -%}
            <div id="timeWarpContainer" class="tnth-hide">
                <div class="prompt">
                    <span class="glyphicon glyphicon-pencil edit-icon" aria-hidden="true"></span><span class="text text-muted">[ time warp patient data ]</span>
                </div>
                <div class="modal fade" id="timeWarpModal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                          <div class="modal-header-title">Time warp patient's data back in time</div>
                        </div>
                        <div class="modal-body">
                            <div class="body-content">
                                <div class="form-group">
                                    By <input type="text" id="timeWarpDays" class="form-control" disabled="false" pattern="(\d)?\d" maxlength="2" width="50"> Days
                                    <div class="help-block"></div>
                                </div>
                                <div class="button-container">
                                    <i class="fa fa-spinner fa-spin fa-2x loading-message"></i>
                                    <a class="btn btn-tnth-primary submit">
                                        <span class="glyphicon glyphicon-plane" aria-hidden="true"></span>
                                        Submit
                                    </a>
                                </div>
                                <div class="error-message"></div>
                                <div class="info-message text-info"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-default" data-dismiss="modal">{{_("Close")}}</button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        {%- endif %}
    </div>
{%- endmacro %}
{% macro profileClinicalQuestions(person, current_user) -%}
    <div class="row">
        <div class="col-md-12">
            <input type="hidden" id="iq_userId" value="{{person.id if person}}" />
            <div id="clinicalQuestionsContainer" class="profile-item-container" data-sections="clinical">
                {{profileEditButton('tnth-hide')}}
                {% call titleSection(id="clinicalQuestionsLoc") %}
                    {% if person.id == current_user.id %}{{_("My Prostate Cancer Profile")}}{% else %}{{ _("Clinical Questions") }}{% endif %}
                {%- endcall %}
                {% if person.id != current_user.id %}<p class="text-muted">{{ _("Questions asked of the patient at registration") }}</p>{% endif %}
                {% call viewSection() -%}
                     <table>
                        <tr><td class="text-muted">{{_("Have you had a prostate cancer biopsy?")}}</td><td><div id="biopsy_view"></div></td></tr>
                        <tr><td class="text-muted">{{_("Have you been diagnosed with prostate cancer?")}}</td><td><div id="pca_diag_view"></div></td></tr>
                        <tr><td class="text-muted">{{_("Is the prostate cancer only within the prostate?")}}</td><td><div id="pca_localized_view"></div></td></tr>
                   </table>
                {%- endcall %}
                {% call editSection() -%}
                    <div id="patientQContainer" data-sections="clinical" data-profile-section-id="clinicalquestions" data-save-container-id="patientQContainer">
                       {{patientQGroup(person)}}
                    </div>
                    {{saveLoaderDiv("patientQContainer")}}
                {%- endcall %}
                <div class="get-clinical-error error-message"></div>
                <div class="put-clinical-error error-message"></div>
                <div class="post-clinical-error error-message"></div>
            </div>
        </div>
    </div>
{%- endmacro %}

{% macro profileInterventionReports(person) -%}
    <div class="row">
            <div class="col-md-12 col-xs-12">
                <div class="profile-item-container" data-profile-section-id="interventionreport">
                    <h4 id="interventionReportsLoc" class="profile-item-title index-item">{{ _("Intervention Reports") }}</h4>
                    <div>
                        {%- if person and person.staff_html() -%}
                            {{person.staff_html() | safe}}
                        {%- else -%}
                            <div class="text-muted">{{ _("No reports available.") }}</div>
                        {%- endif -%}
                    </div>
                </div>
            </div>
    </div>
{%- endmacro %}

{% macro profileTimeZone(person) %}
    <div id="profileTimeZoneGroup" class="form-group timezone-container flex-item">
        <label>Time Zone</label>
        <!--TODO dynamically generate this list-->
        <select class="form-control" id="profileTimeZone" data-save-container-id="profileTimeZoneGroup" v-model="demo.data.timezone" v-on:change="updateExtensionData">
            <option value="UTC">{{_("Select")}}</option>
            <option value="Africa/Johannesburg">{{_("Africa/Johannesburg")}}</option>
            <option value="America/Chicago">{{_("America/Chicago")}}</option>
            <option value="America/Denver">{{_("America/Denver")}}</option>
            <option value="America/Los_Angeles">{{_("America/Los Angeles")}}</option>
            <option value="America/Indianapolis">{{_("America/Indianapolis")}}</option>
            <option value="America/New_York">{{_("America/New York")}}</option>
            <option value="America/Sao_Paulo">{{_("America/Sao Paulo")}}</option>
            <option value="Australia/Adelaide">{{_("Australia/Adelaide")}}</option>
            <option value="Australia/Brisbane">{{_("Australia/Brisbane")}}</option>
            <option value="Australia/Broken_Hill">{{_("Australia/Broken_Hill")}}</option>
            <option value="Australia/Canberra">{{_("Australia/Canberra")}}</option>
            <option value="Australia/Currie">{{_("Australia/Currie")}}</option>
            <option value="Australia/Darwin">{{_("Australia/Darwin")}}</option>
            <option value="Australia/Eucla">{{_("Australia/Eucla")}}</option>
            <option value="Australia/Hobart">{{_("Australia/Hobart")}}</option>
            <option value="Australia/Lindeman">{{_("Australia/Lindeman")}}</option>
            <option value="Australia/Lord_Howe">{{_("Australia/Lord_Howe")}}</option>
            <option value="Australia/Melbourne">{{_("Australia/Melbourne")}}</option>
            <option value="Australia/North">{{_("Australia/North")}}</option>
            <option value="Australia/Perth">{{_("Australia/Perth")}}</option>
            <option value="Australia/Queensland">{{_("Australia/Queensland")}}</option>
            <option value="Australia/South">{{_("Australia/South")}}</option>
            <option value="Australia/Sydney">{{_("Australia/Sydney")}}</option>
            <option value="Australia/Tasmania">{{_("Australia/Tasmania")}}</option>
            <option value="Australia/Victoria">{{_("Australia/Victoria")}}</option>
            <option value="Australia/West">{{_("Australia/West")}}</option>
            <option value="Australia/Yancowinna">{{_("Australia/Yancowinna")}}</option>
            <option value="Europe/Andorra">{{_("Europe/Andorra")}}</option>
            <option value="Europe/Vienna">{{_("Europe/Vienna")}}</option>
            <option value="Europe/Brussels">{{_("Europe/Brussels")}}</option>
            <option value="Europe/Andorra">{{_("Europe/Andorra")}}</option>
            <option value="Europe/Stockholm">{{_("Europe/Stockholm")}}</option>
            <option value="Europe/Sofia">{{_("Europe/Sofia")}}</option>
            <option value="Europe/Zurich">{{_("Europe/Zurich")}}</option>
        </select>
    </div>
    {{saveLoaderDiv("profileTimeZoneGroup")}}
{%-endmacro %}

{% macro profileDeceased(person, current_user) -%}
    <div class="row">
        <div class="col-md-12 col-xs-12">
            {% call profileSection(id="profileDeceasedSection", data_sections="deceased") -%}
                {% call titleSection(id="deathLoc") -%}{{_("Deceased Status")}}{%- endcall%}
                <input type="hidden" id="deathDate" value=""/>
                {% call viewSection() -%}
                    <div id="boolDeath_view" v-show="demo.data.deceasedBoolean || demo.data.deceasedDateTime">{{_("Patient is deceased")}}</div>
                    <div id="deathDate_view" v-show="demo.data.deceasedDateTime">
                        {% raw %}
                            <p>{{demo.data.displayDeceasedDate}}</p>
                        {% endraw %}
                    </div>
                    <div v-show="!demo.data.deceasedBoolean && !demo.data.deceasedDateTime" class="text-muted">{{_("no data provided")}}</div>
                {%- endcall %}
                {% call editSection() -%}
                    <div class="checkbox" id="boolDeathGroup" data-save-container-id="boolDeathGroup">
                        <label><input type="checkbox" name="boolDeath" id="boolDeath" value="1" />{{_("Has the patient passed away?")}}</label>
                        <a id="deceasedConsentPopover" data-toggle="popover"  data-placement="top" data-container="body" data-trigger="manual" data-html="true" data-content="<div class='deceased-popover-content'>{{_("By checking this box, the patient's consent status will be updated to '%(new_consent_status)s'. Do you want to continue?", new_consent_status=_("Withdrawn - Suspend Data Collection"))}}</div><div class='deceased-popover-buttons-container'><button id='btnDeceasedConsentYes'>{{_('Yes')}}</button><button id='btnDeceasedConsentNo'>{{_('No')}}</button></div>"></a>
                    </div>
                    {{saveLoaderDiv("boolDeathGroup")}}
                    <div id="deceasedInfo" class="error-message"></div>
                    <div class="form-group">
                        <label class="text-muted">{{_("Deceased Date")}}</label>
                    </div>
                    <div id="deceasedDateContainer" class="row deceased-date-container" data-profile-section-id="deceased" data-save-container-id="deceasedDateContainer">
                        <div class="col-md-3 col-xs-6">
                            <div id="deathDayContainer" class="form-group profile-section">
                                <input class="form-control" id="deathDay" name="deathDay"  placeholder="DD" type="text" pattern="\d[\d]?" maxlength="2" required />
                                 <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="col-md-3 col-xs-10">
                            <div id="deathMonthContainer" class="form-group profile-section">
                                <select class="form-control" name="deathMonth" id="deathMonth" required>
                                    <option value="">{{ _("Month") }}...</option>
                                    <option value="01">{{ _("January") }}</option>
                                    <option value="02">{{ _("February") }}</option>
                                    <option value="03">{{ _("March") }}</option>
                                    <option value="04">{{ _("April") }}</option>
                                    <option value="05">{{ _("May") }}</option>
                                    <option value="06">{{ _("June") }}</option>
                                    <option value="07">{{ _("July") }}</option>
                                    <option value="08">{{ _("August") }}</option>
                                    <option value="09">{{ _("September") }}</option>
                                    <option value="10">{{ _("October") }}</option>
                                    <option value="11">{{ _("November") }}</option>
                                    <option value="12">{{ _("December") }}</option>
                                </select>
                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="col-md-3 col-xs-6">
                            <div id="deathYearContainer" class="form-group profile-section">
                                <input class="form-control" id="deathYear" name="deathYear" placeholder="YYYY" pattern = "\d{4}" type="text" maxlength="4"  required />
                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                    </div>
                {%- endcall %}
                {{saveLoaderDiv("deceasedDateContainer")}}
                <div id="errorDeathDate" class="get-demo-error error-message"></div>
                <div class="put-demo-error error-message"></div>
            {%- endcall %}
        </div>
    </div>
{%- endmacro %}
{% macro profileStudyID(user) -%}
    <div id="profileStudyIDContainer" class="form-group" data-loader-container="true" data-profile-section-id="identifier">
        <label class="text-muted">{{_("Study ID")}} <span class="text-muted smaller-text optional-display-text">({{ _("Optional") }})</span></label>
        <input type="text" id="profileStudyId" data-identifier="true" data-systemtype="external_study_id" data-userid="{{user.id if user}}" class="form-control" v-model.lazy="demo.data.studyId" v-bind:disabled="isDisableField('study_id')" data-protected-fieldid="study_id"/>
        <div class="help-block with-errors"></div>
        <div id="errorprofileStudyId" class="error-message"></div>
        {{saveLoaderDiv("profileStudyIDContainer")}}
    </div>
{%- endmacro %}
{% macro profileSiteID(user) -%}
    <div id="profileSiteIDContainer" class="form-group" data-loader-container="true">
        <label id="profileSiteID" class="text-muted">{{_("Site ID")}}</label>
        <input type="text" id="profileSiteId" aria-labelledby="profileSiteID" data-systemtype="external_site_id" data-identifier="true" data-userid="{{user.id if user}}" class="form-control" data-htmltags="true" data-error-field="errorprofileSiteId" v-model.lazy="demo.data.siteId"/>
        <div class="help-block with-errors"></div>
        {{saveLoaderDiv("profileSiteIDContainer")}}
        <div id="errorprofileSiteId" class="error-message"></div>
    </div>
{%- endmacro %}
{% macro profileCustomDetail(person) -%}
     <div class="row" data-profile-section-id="custompatientdetail">
        <div class="col-md-12 col-xs-12">
            <h4 class="profile-item-title detail-title">{{_("Three ways to complete questionnaire")}}</h4>
            <div class="custom-container">
                <input type="text" style="position: fixed; left: -10000000px;" autofocus/>
                <div class="profile-item-container custom-container-item-right">
                    <h4 id="customSendEmailLoc" class="profile-item-title index-item">{{_("Send email")}}</h4>
                    <br/>
                    <div class="text-muted custom-container-content">{{_("Invite or remind patient over email to complete their questionnaire")}}</div>
                    <div>{{profileSendEmail(person)}}</div>
                </div>
                <div class="profile-item-container custom-container-item-right">
                    <h4 id="customLoginAsLoc" class="profile-item-title index-item">{{_("Log in as patient")}}</h4>
                    <div class="custom-container-content text-muted">{{_("This logs you out, and logs in the patient without their needing to enter credentials. This is so the patient can complete their questionnaire on this device. Ideal for tablet and kiosk computers.")}}</div><br/>
                    <button id="loginAsButton" class="btn btn-tnth-primary custom-btn disabled" type="button" disabled>{{_("Log in as patient")}}</button>
                </div>
                 <div class="profile-item-container custom-container-item">
                    <h4 id="customEnterManuallyLoc" class="profile-item-title index-item">{{_("Enter manually")}}</h4><br/>
                    <input type="hidden" id="manualEntrySubjectId" value="{{person.id}}" />
                    <div class="custom-container-content enter-manual-container text-muted">{{_("Enter questionnaire responses on patient's behalf. Helpful if responses have been completed on paper.")}}</div><br/>
                    <div id="enterManualInfoContainer" class="text-info"></div>
                    <a class="btn btn-tnth-primary custom-btn" id="assessmentLink" data-toggle="modal" data-target="#manualEntryModal">{{_("Enter manually")}}</a>
                    <div class="modal fade" id="manualEntryModal" tabindex="-1" role="dialog" aria-labelledby="assessmentLink">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">{{ _("Enter questionnaire manually on patient's behalf") }}</h4>
                                </div>
                                <div class="modal-body">
                                    <div id="manualEntryBodyLoader" v-show="!manualEntry.init">
                                        <i class="fa fa-spinner fa-spin fa-2x loading-message"></i>
                                    </div>
                                    <div id="manualEntryMain" v-show="manualEntry.init">
                                        <p class="text-left">{{ _("Select the method in which the questionnaire will be completed:") }}</p>
                                        <input type="hidden" id="manualEntryConsentDate" v-model="manualEntry.consentDate" />
                                        <input type="hidden" id="qCompletionDate" v-model="manualEntry.completionDate" />
                                        <input type="hidden" id="qToday" v-model="manualEntry.todayObj.gmtDate" />
                                        <div class="form-group">
                                            <div class="profile-radio-list">
                                                <label class="radio-inline">
                                                    <input type="radio" name="entryMethod" id="interviewAssisted" value="interview_assisted" v-model="manualEntry.method"/>
                                                    <span>{{ _("Interview assisted") }}</span>
                                                </label>
                                                <br/>
                                                <label class="radio-inline">
                                                    <input type="radio" name="entryMethod" id="paper" value="paper" v-model="manualEntry.method"/>
                                                    <span>{{ _("Paper") }}</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div id="manualEntryCompletionDateContainer" v-show="manualEntry.method == 'paper'">
                                            <div id="manualEntryVisitContainer" v-show="hasTimeline()">
                                                <div>
                                                    <label class="text-muted" for="qVisit">{{_("Please select a visit")}}</label>
                                                    <select class="form-control" id="manualEntryVisitSelector">
                                                        <option value="">{{_("Select")}}</option>
                                                        <option v-for="item in manualEntry.timeline" :value="item.visit"
                                                        :disabled="item.completed"
                                                        :data-startdate="item.startDate"
                                                        :data-enddate="item.endDate" v-text="item.display"></option>
                                                    </select>
                                                </div>
                                                <div class="info text-muted" v-show="hasSelectedManualEntryVisit()"></div>
                                            </div>
                                            <label class="text-muted manualentry-date-label" for="manualEntryDateFieldsContainer" v-text="getManualEntryQuestionnaireDateLabel()"></label>
                                            <div class="form-group">
                                                <div id="manualEntryDateFieldsContainer" class="flex">
                                                    <div class="flex-item">
                                                        <input class="form-control" id="qCompletionDay" aria-label="{{_('Completion Day')}}"  data-exempt-from-disabling="true" name="qCompletionDay" placeholder="DD" type="text" pattern="(\d)?\d" maxlength="2" data-error="{{_('Date must be valid and in the required format.')}}" autocomplete="off" data-trigger-event="change" required />
                                                    </div>
                                                    <div class="flex-item" id="qCompletionMonthContainer">
                                                        <select class="form-control" aria-label="{{_('Month')}}" name="qCompletionMonth" id="qCompletionMonth" data-exempt-from-disabling="true" data-error="{{_('Date must be valid and in the required format.')}}" data-trigger-event="change" required>
                                                            <option value="">{{_("Month")}}...</option>
                                                            <option value="01">{{_("January")}}</option>
                                                            <option value="02">{{_("February")}}</option>
                                                            <option value="03">{{_("March")}}</option>
                                                            <option value="04">{{_("April")}}</option>
                                                            <option value="05">{{_("May")}}</option>
                                                            <option value="06">{{_("June")}}</option>
                                                            <option value="07">{{_("July")}}</option>
                                                            <option value="08">{{_("August")}}</option>
                                                            <option value="09">{{_("September")}}</option>
                                                            <option value="10">{{_("October")}}</option>
                                                            <option value="11">{{_("November")}}</option>
                                                            <option value="12">{{_("December")}}</option>
                                                        </select>
                                                    </div>
                                                    <div class="flex-item" id="qCompletionYearContainer">
                                                        <input class="form-control" id="qCompletionYear" name="qCompletionYear" aria-label="{{_('Completion Year')}}" data-exempt-from-disabling="true" placeholder="YYYY" pattern = "(19|20)\d{2}" type="text" maxlength="4" data-error="{{_('Date must be valid and in the required format.')}}" data-trigger-event="change" autocomplete="off" required />
                                                    </div>
                                                </div>
                                                <div class="help-block with-errors"></div>
                                            </div>
                                        {% raw %}
                                            <div id="manualEntryWarningMessageContainer" class="error-message" v-show="isCompletionDateOutofWindow()" v-html="manualEntry.outofWindowMessage"></div>
                                            <div id="manualEntryMessageContainer" class="error-message help-block with-errors">{{manualEntry.errorMessage}}</div>
                                        {% endraw %}
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <div id="manualEntryLoader" class="loading-message-indicator" v-show="manualEntry.loading">
                                        <i class="fa fa-spinner fa-spin fa-2x loading-message"></i>
                                    </div>
                                    <div id="manualEntryButtonsContainer" v-show="!manualEntry.loading">
                                        <a href="#" id="meSubmit" class="btn btn-default" v-bind:disabled="(!manualEntry.method) || manualEntry.errorMessage || !hasSelectedManualEntryVisit()">{{_("OK")}}</a>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">{{_("Cancel")}}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{%- endmacro %}
{% macro profileInterventions(user_interventions) -%}
  <div class="row">
        <div class="col-md-12 col-xs-12">
            <div class="profile-item-container" data-profile-section-id="interventionlist">
                <h4 id="interventionsLoc" class="profile-item-title index-item">{{_("Interventions")}}</h4>
                    {% if user_interventions %}
                        {% if user_interventions.length != 0 %}<p class="text-muted">{{_("Patient is participating in the following intervention(s): ")}}</p>{% endif %}
                        {% for intervention in user_interventions %}
                            <div class="capitalize">{{intervention.name | replace("_", " ")}}</div>
                        {% endfor %}
                        {% if user_interventions.length == 0 %}<div class="text-muted">{{_("None")}}</div>{% endif %}
                    {% else %}
                        <div class="text-muted">{{_("None")}}</div>
                    {% endif %}
                </div>
            </div>
    </div>
{%- endmacro %}
{% macro profileProcedures(person, current_user) -%}
    {% set top_org = current_user.first_top_organization() if current_user else False %}
    <div class="row">
        <div class="col-md-12 col-xs-12">
            <div id="profileProceduresWrapper" class="profile-item-container editable" data-sections="procedure" data-profile-section-id="procedure" data-top-org-id="{{top_org.id if top_org}}" data-top-org-name="{{top_org.name if top_org}}" {% if person and person.id == current_user.id %}data-user-view="true"{% endif %} data-profile-section-id="procedure">
                <input type="hidden" id="profileProcSubjectId" value="{{person.id if person}}" />
                <input type="hidden" id="profileProcCurrentUserId" value="{{current_user.id if current_user}}" />
                {{profileEditButton()}}
                {% call titleSection(id="clinicalDataLoc") -%}
                    {% if person and person.id == current_user.id %}{{_("My Treatments")}}{%else%}{{ _("Clinical Data") }}{% endif %}&nbsp;<span class="optional-display-text text-muted tnth-hide">{{_("(Optional)")}}</span>
                {%- endcall %}
                {% call viewSection() %}<div id="procedure_view"></div>{% endcall %}
                {% call editSection() -%}
                    <p class="title-text text-muted">
                        {%-if current_user and current_user.has_role(ROLE.STAFF.value, ROLE.STAFF_ADMIN.value) -%}
                            {{ _("Which of the following prostate cancer management options has the patient had, if any? If you don&#39;t remember the exact date, please make your best guess.") }}
                        {%-elif person and current_user and (person.id == current_user.id) -%}
                            {{ _("Which of the following prostate cancer management options have you had, if any? If you don&#39;t remember the exact
                            date, please make your best guess.") }}
                        {% else %}
                            {{ _("Which of the following prostate cancer management options has the patient had, if any? If you don&#39;t remember the exact date, please make your best guess.") }}
                        {%-endif-%}
                    </p><br/>
                    <div id="profileProcedureContainer">
                        <div id="procedureForm" class="form-inline event-element">
                            <p class="text-muted">{{ _("Select an option") }}:</p>
                            <div class="row">
                                <div class="col-md-9 col-xs-11">
                                    <div class='form-group'>
                                        <select class='form-control' id='tnthproc'></select>
                                        <div class="help-block with-errors"></div>
                                    </div>
                                </div>
                            </div>
                            <br/>
                            <div id="procDateGroup" class="form-group">
                                <label class="procedureDateLabel">{{ _("Date") }}:</label>
                                <div class="flex">
                                    <div class="flex-item">
                                        <input class="form-control" id="procDay" name="procDay" type="text" placeholder="DD" maxlength="2" data-error="{{_('Date must be valid and in the required format.')}}"/>
                                    </div>
                                    <div class="flex-item">
                                        <select class="form-control" name="procMonth" id="procMonth" data-error="{{_('Date must be valid and in the required format.')}}">
                                            <option value="">{{_("Month")}}...</option>
                                            <option value="01">{{_("January")}}</option>
                                            <option value="02">{{_("February")}}</option>
                                            <option value="03">{{_("March")}}</option>
                                            <option value="04">{{_("April")}}</option>
                                            <option value="05">{{_("May")}}</option>
                                            <option value="06">{{_("June")}}</option>
                                            <option value="07">{{_("July")}}</option>
                                            <option value="08">{{_("August")}}</option>
                                            <option value="09">{{_("September")}}</option>
                                            <option value="10">{{_("October")}}</option>
                                            <option value="11">{{_("November")}}</option>
                                            <option value="12">{{_("December")}}</option>
                                        </select>
                                    </div>
                                    <div class="flex-item">
                                        <input class="form-control" id="procYear" name="procYear" placeholder="YYYY" type="text" maxlength="4" data-error="{{_('Date must be valid and in the required format.')}}"/>
                                    </div>
                                </div>
                                <div id="procDateErrorContainer" class="help-block with-errors error-message"></div>
                                <div class="button-container">
                                    <button class='btn btn-default' id='tnthproc-submit' name='tnthproc' data-name='' data-date='' data-date-read='' {% if not person %}data-account-create='true'{% endif %} type="submit" disabled><i class='fa fa-plus'></i>&nbsp;<span class="smaller-text">{%-if person-%}{{_("Save")}}{%-else-%}{{_("Add")}}{%-endif-%}</span></button>
                                </div>
                            </div>
                            {% if person %}
                                <br />
                                <br />
                                <div id="eventListLoad"><i class="fa fa-spinner fa-spin fa-2x loading-message"></i></div>
                                <div id="pastTreatmentsContainer" class="inner">
                                     <hr style="border-bottom: 1px solid #e5e5e5"/>
                                    {%- if person.id == current_user.id -%}
                                        <p class="text-muted">{{_("My History")}}:</p>
                                    {%- else -%}
                                        <p class="text-muted"><em>{{_("Past")}}</em>&nbsp;{{ _("Management(s)") }}:</p>
                                    {%- endif -%}
                                    <div id="userProcedures"></div>
                                </div>
                                <br/>
                            {% else %}
                                <table id="pastTreatmentsContainer" class="inner"></table>
                            {% endif %}
                            <div id="procErrorMessage" class="error-message"></div>
                            <div id="popoverHolder" class="tnth-hide">
                                <div class="popover__link">
                                    <a data-toggle="popover" class="btn btn-default btn-xs confirm-delete" data-content="" rel="popover"><i class="fa fa-times"></i> {{_("Delete")}}</a>
                                </div>
                                <div class="popover__content">
                                    <span>{{_("Are you sure you want to delete this treatment?")}}</span>
                                    <br /><br />
                                    <a class="btn-delete btn btn-tnth-primary">{{_("Yes")}}</a> &nbsp;&nbsp;&nbsp; <a class="btn cancel-delete">{{_("No")}}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {%- endcall%}
            </div>
        </div>
    </div>
{%- endmacro %}
{% macro profileSaveBtn() -%}
    <p id="saveMsg" class="error-message text-muted  bg-warning" style="display: none"><small>{{ _("You have updated your profile. Click the Save button to submit your changes.") }} {{ _("Or") }} <a href="">{{ _("cancel") }}</a>.</small></p>
    <p id="errorMsg" class="error-message text-muted  bg-danger" style="display: none"><small>{{ _("There is a problem with your profile. Please correct it before saving.") }}<br/>{{ _("Make sure all required fields are filled out and all entries are valid.") }}</small></p>
    <p id="serviceErrorMsg" class="error-message text-muted bg-danger" style="display: none"></p>
    <button id="updateProfile" type="submit" class="btn btn-lg btn-tnth-primary">{{ _("Save") }}</button>
    <span id="confirmMsg" class="text-muted tnth-hide small-text">&nbsp;&nbsp;<em>{{ _("Profile changes have been saved") }}</em></span>
{%- endmacro %}
