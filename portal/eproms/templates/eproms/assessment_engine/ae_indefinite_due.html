{%- from "eproms/assessment_engine/ae_macros.html" import render_header, render_greeting, render_card_content, render_call_to_button, due_card, completed_card, empro_due, empro_completed, completed_cards -%}
{% extends "eproms/assessment_engine/ae_base.html" %}
<!-- User completed baseline, but has outstanding indefinite work -->
{% block head %}
    {% call render_header(title_text=render_greeting(full_name=full_name)) %}
        {{_("Please complete your %(assigning_authority)s questionnaire at your convenience.",
                assigning_authority=_(assessment_status.assigning_authority))}}
    {% endcall %}
{% endblock %}
{% block body %}
    {%- set button_label = _("Continue questionnaire") if unfinished_indefinite_instruments else _("Go to questionnaire") -%}
    <!-- tile title change for sub-study questionnaire is due.  NOTE: sub-study DUE tile is not available when main study questionnaire is not completed yet -->
    {% set due_title_text = _("%(assigning_authority)s Questionnaire", assigning_authority=_(assessment_status.assigning_authority))
        if enrolled_in_substudy else _("Open Questionnaire") %}
    <!-- tile title for completed card, NOTE:  need to differentiate between main and sub-study -->
    {% set completed_title_text = _("%(assigning_authority)s Questionnaire", assigning_authority=_(assessment_status.assigning_authority))
        if enrolled_in_substudy else _("Completed Questionnaire") %}
    <!-- main study due card -->
    {{due_card(assessment_status=assessment_status, button_label=button_label, title_text=due_title_text)}}
    {%- if enrolled_in_substudy -%}
        <!-- show main study completed card first -->
        {{completed_card(
            assessment_status=assessment_status,
            OverallStatus=OverallStatus,
            comp_date=comp_date,
            title_text=completed_title_text)
        }}
        <!-- it is possible that user has completed empro at this point, so need to show -->
        {{empro_completed(
            user=user,
            OverallStatus=OverallStatus,
            substudy_assessment_status=substudy_assessment_status,
            substudy_comp_date=substudy_comp_date,
            enrolled_in_substudy=enrolled_in_substudy,
            card_class="disabled" if not substudy_assessment_status.overall_status == OverallStatus.completed else ""
        )}}
    {%- else -%}
        <!-- main study completed tile -->
        {{completed_card(assessment_status=assessment_status, OverallStatus=OverallStatus, comp_date=comp_date, title_text=completed_title_text)}}
    {%- endif -%}
{% endblock %}
