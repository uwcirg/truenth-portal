!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";t.a={external_study_id:"http://us.truenth.org/identity-codes/external-study-id",external_site_id:"http://us.truenth.org/identity-codes/external-site-id",practice_region:"http://us.truenth.org/identity-codes/practice-region",race:"http://hl7.org/fhir/StructureDefinition/us-core-race",race_system:"http://hl7.org/fhir/v3/Race",ethnicity:"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity",ethnicity_system:"http://hl7.org/fhir/v3/Ethnicity",indigenous:"http://us.truenth.org/fhir/StructureDefinition/AU-NHHD-METeOR-id-291036",timezone:"http://hl7.org/fhir/StructureDefinition/user-timezone",language:"http://hl7.org/fhir/valueset/languages",language_system:"urn:ietf:bcp:47",shortname:"http://us.truenth.org/identity-codes/shortname",SNOMED_SYS_URL:"http://snomed.info/sct",CLINICAL_SYS_URL:"http://us.truenth.org/clinical-codes",CANCER_TREATMENT_CODE:"118877007",NONE_TREATMENT_CODE:"999"}},function(e,t,r){"use strict";r.d(t,"b",function(){return a}),r.d(t,"c",function(){return o});var n,i=((n=function(){this.requestAttempts=0}).prototype.hasValue=function(e){return"null"!==String(e)&&""!==String(e)&&"undefined"!==String(e)},n.prototype.showMain=function(){$("#mainHolder").css({visibility:"visible","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)",filter:"alpha(opacity=100)","-moz-opacity":1,"-khtml-opacity":1,opacity:1})},n.prototype.hideLoader=function(e,t){e?$("#loadingIndicator").hide():setTimeout(function(){$("#loadingIndicator").fadeOut()},t||200)},n.prototype.loader=function(e){if(document.getElementById("fullSizeContainer"))return this.hideLoader(),this.showMain(),!1;if(e)$("#loadingIndicator").show();else if(!this.isDelayLoading()){var t=this;setTimeout(function(){t.showMain()},100),this.hideLoader(!0,350)}},n.prototype.isDelayLoading=function(){return"undefined"!=typeof DELAY_LOADING&&DELAY_LOADING},n.prototype.isTouchDevice=function(){return!0===("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)},n.prototype.getIEVersion=function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return!!e&&parseInt(e[1])},n.prototype.newHttpRequest=function(e,t,r){this.requestAttempts++;var n,i=this;for(var a in r=r||function(){},window.XDomainRequest?(n=new XDomainRequest).onload=function(){r(n.responseText)}:n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===n.readyState){if(200===n.status)return r(n.responseText),void(i.requestAttempts=0);i.requestAttempts<3?setTimeout(function(){i.newHttpRequest(e,t,r)},3e3):(r({error:n.responseText}),i.loader(),i.requestAttempts=0)}},t=t||{},n.open("GET",e,!0),t)t.hasOwnProperty(a)&&n.setRequestHeader(a,t[a]);t.cache||(n.setRequestHeader("cache-control","no-cache"),n.setRequestHeader("expires","-1"),n.setRequestHeader("pragma","no-cache")),n.send()},n.prototype.ajaxRequest=function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("Url is required.")}),!1;var n={url:e,type:"GET",contentType:"text/plain",timeout:5e3,cache:!1};t=t||n,t=$.extend({},n,t),this.requestAttempts++;var i=this;$.ajax(t).done(function(e){r(e),i.requestAttempts=0}).fail(function(){i.requestAttempts<=3?setTimeout(function(){i.ajaxRequest(e,t,r)},3e3):(r({error:i18next.t("Error occurred processing request")}),i.requestAttempts=0,i.loader())}).always(function(){i.loader()})},n.prototype.initWorker=function(e,t,r){var n=new Worker("/static/js/ajaxWorker.js"),i=this;n.postMessage({url:e,params:t}),n.addEventListener("message",function(e){r.call(i,e.data),n.terminate()},!1),n.addEventListener("error",function(e){console.log("Worker runtime error: Line ",e.lineno," in ",e.filename,": ",e.message),n.terminate()},!1)},n.prototype.workerAllowed=function(){return window.Worker&&!this.isTouchDevice()},n.prototype.getRequestMethod=function(){return this.getIEVersion()?this.newHttpRequest:this.ajaxRequest},n.prototype.sendRequest=function(e,t,r){if((t=t||{}).useWorker&&this.workerAllowed())return this.initWorker(e,t,r),!0;this.getRequestMethod().call(this,e,t,function(e){r.call(this,e)})},n.prototype.LRKeyEvent=function(){$(".button--LR").length>0&&$("html").on("keydown",function(e){parseInt(e.keyCode)===parseInt(187)&&$(".button--LR").toggleClass("data-show")})},n.prototype.getLoaderHTML=function(e){return'<div class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i>'.concat(e?"&nbsp;"+e:"","</div>")},n.prototype.convertToNumericField=function(e){e&&this.isTouchDevice()&&e.each(function(){$(this).prop("type","tel")})},n.prototype.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},n.prototype.disableHeaderFooterLinks=function(){var e=$("#tnthNavWrapper a, #homeFooter a").not("a[href*='logout']").not("a.required-link").not("a.home-link");e.addClass("disabled"),e.prop("onclick",null).off("click"),e.on("click",function(e){return e.preventDefault(),!1})},n.prototype.pad=function(e){return e=parseInt(e),!isNaN(e)&&e<10?"0"+e:e},n.prototype.escapeHtml=function(e){return null===e||"undefined"!==e||0===String(e).length?e:e.replace(/[\"&'\/<>]/g,function(e){return{'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#47;","<":"&lt;",">":"&gt;"}[e]})},n.prototype.containHtmlTags=function(e){return!!e&&/[<>]/.test(e)},n.prototype.getExportFileName=function(e){var t=new Date;return(e||"ExportList_")+("00"+t.getDate()).slice(-2)+("00"+(t.getMonth()+1)).slice(-2)+t.getFullYear()},n.prototype.capitalize=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},n.prototype.restoreVis=function(){var e=document.getElementById("loadingIndicator"),t=document.getElementById("mainHolder");e&&e.setAttribute("style","display:none; visibility:hidden;"),t&&t.setAttribute("style","visibility:visible;-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=100)';filter:alpha(opacity=100); -moz-opacity:1; -khtml-opacity:1; opacity:1")},n.prototype.VueErrorHandling=function(){if("undefined"==typeof Vue)return!1;var e=this;Vue.config.errorHandler=function(t,r,n){var i,a=r;if(r.$options.errorHandler)i=r.$options.errorHandler;else for(;!i&&a.$parent;)i=(a=a.$parent).$options.errorHandler;e.restoreVis(),i?i.call(a,t,r,n):console.log(t)}},n.prototype.extend=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},n.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1])},n.prototype.resetBrowserBackHistory=function(e,t,r){var n="undefined"!=typeof history&&history.pushState;e=e||location.href,n&&history.pushState(t,r,e),window.addEventListener("popstate",function(){n?history.pushState(t,r,e):window.history.forward(1)})},n.prototype.handlePostLogout=function(){if("undefined"==typeof sessionStorage)return!1;sessionStorage.getItem("logout")&&(this.resetBrowserBackHistory(location.orgin,"logout"),sessionStorage.removeItem("logout"))},n.prototype.displaySystemOutageMessage=function(e){if(e=(e=e||"en-us").replace("_","-"),document.getElementById("systemMaintenanceContainer")){var t=this;this.ajaxRequest("api/settings",{contentType:"application/json; charset=utf-8"},function(r){if(!r||!r.MAINTENANCE_MESSAGE&&!r.MAINTENANCE_WINDOW)return!1;var n=document.querySelector(".message-container");if(n||((n=document.createElement("div")).classList.add("message-container"),document.getElementById("systemMaintenanceContainer").appendChild(n)),r.MAINTENANCE_MESSAGE)n.innerHTML=t.escapeHtml(r.MAINTENANCE_MESSAGE);else if(r.MAINTENANCE_WINDOW&&r.MAINTENANCE_WINDOW.length){var i,a,o=new Date(r.MAINTENANCE_WINDOW[0]),s=new Date(r.MAINTENANCE_WINDOW[1]),u=(i=new Date,a=o,i&&a?Math.floor((a.getTime()-i.getTime())/36e5%24):0);if(u<0||isNaN(u))document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide");else try{var c={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0,timeZoneName:"short"},d=o.toLocaleString(e,c).replace(/[,]/g," "),l=s.toLocaleString(e,c).replace(/[,]/g," "),f=["<div>"+i18next.t("Hi there.")+"</div>","<div>"+i18next.t("TrueNTH will be down for website maintenance starting <b>{startdate}</b>. This should last until <b>{enddate}</b>.".replace("{startdate}",d).replace("{enddate}",l))+"</div>","<div>"+i18next.t("Thanks for your patience while we upgrade our site.")+"</div>"].join("");n.innerHTML=t.escapeHtml(f)}catch(e){console.log("Error occurred converting system outage date/time ",e),document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide")}}})}},new n);t.a=i;var a=i.getExportFileName,o=i.getUrlParameter},function(e,t,r){"use strict";r.d(t,"b",function(){return i});var n={validateDateInputFields:function(e,t,r,n){var i=$(e).val(),a=$(t).val(),o=$(r).val();if(i&&a&&o){if($(r).get(0).validity.valid&&$(e).get(0).validity.valid&&$(t).get(0).validity.valid){i=parseInt(i),a=parseInt(a),o=parseInt(o);var s=$("#"+n);if(isNaN(i)||isNaN(a)||isNaN(o))return!1;var u=new Date,c=new Date(o,i-1,a);return c.getFullYear()!==o||c.getMonth()+1!==i||c.getDate()!==a?(s.html(i18next.t("Invalid date. Please try again.")).show(),!1):c.setHours(0,0,0,0)>u.setHours(0,0,0,0)?(s.html(i18next.t("Date must not be in the future. Please try again.")).show(),!1):o<1900?(s.html(i18next.t("Date must not be before 1900. Please try again.")).show(),!1):(s.html("").hide(),!0)}return!1}return!1},swap_mm_dd:function(e){var t=e.split("/");return t[1]+"/"+t[0]+"/"+t[2]},convertMonthNumeric:function(e){if(e){var t={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12}[e.toLowerCase()];return t||""}return""},convertMonthString:function(e){if(e){var t={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}[parseInt(e)];return t||""}return""},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},displayDateString:function(e,t,r){var n="";return n+=t||"",e&&(n+=(n?" ":"")+this.convertMonthString(e)),r&&(n+=(n?" ":"")+r),n},getDateDiff:function(e,t){var r,n=e.split(/[^0-9]/),i=new Date(n[0],n[1]-1,n[2]).getTime();if(t){var a=t.split(/[^0-9]/);r=new Date(a[0],a[1]-1,a[2]).getTime()}else r=(new Date).getTime();return Math.floor((r-i)/864e5)},isValidDefaultDateFormat:function(e,t){if(!e||e.length<10)return!1;var r=$.trim(e).split(" ");if(r.length<3)return!1;var n=parseInt(r[0])+"",i=r[1],a=r[2];if(n.length<1||i.length<3||a.length<4)return!1;if(!/(0)?[1-9]|1\d|2\d|3[01]/.test(n))return!1;if(!/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/i.test(i))return!1;if(!/(19|20)\d{2}/.test(a))return!1;var o=new Date(e);if(this.isDateObj(o)){if(this.isValidDate(a,this.convertMonthNumeric(i),n)){var s=new Date,u="";return o.getFullYear()<1900&&(u="Year must be after 1900"),o.setHours(0,0,0,0)>s.setHours(0,0,0,0)&&(u="The date must not be in the future."),u?($(t).text(u),!1):($(t).text(""),!0)}return!1}return!1},isDateObj:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},isValidDate:function(e,t,r){var n=this.getDateObj(e,t,r),i=this.getConvertedDate(n),a=this.getGivenDate(e,t,r);return String(a)===String(i)},getDateObj:function(e,t,r,n,i,a){return n=n||0,i=i||0,a=a||0,new Date(parseInt(e),parseInt(t)-1,parseInt(r),parseInt(n),parseInt(i),parseInt(a))},getConvertedDate:function(e){return e&&this.isDateObj(e)?""+e.getFullYear()+(e.getMonth()+1)+e.getDate():""},getGivenDate:function(e,t,r){return""+e+t+r},formatDateString:function(e,t){if(e){var r,n,i,a,o,s,u,c=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,d=new Date(e);if(!c&&!isNaN(d)&&!this.isDateObj(d))return"";if(c.test(e)){var l=$.trim($.trim(e).replace(/[\.TZ:\-]/gi," ")).split(" ");i=l[0],n=l[1],r=l[2],a=l[3]||"0",o=l[4]||"0",s=l[5]||"0"}else r=d.getDate(),n=d.getMonth()+1,i=d.getFullYear(),a=d.getHours(),o=d.getMinutes(),s=d.getSeconds(),u="";var f=function(e){return(e=parseInt(e))<10?"0"+e:e};switch(r=f(r),n=f(n),a=f(a),o=f(o),s=f(s),t){case"mm/dd/yyyy":u=n+"/"+r+"/"+i;break;case"mm-dd-yyyy":u=n+"-"+r+"-"+i;break;case"mm-dd-yyyy hh:mm:ss":u=n+"-"+r+"-"+i+" "+a+":"+o+":"+s;break;case"dd/mm/yyyy":u=r+"/"+n+"/"+i;break;case"dd/mm/yyyy hh:mm:ss":u=r+"/"+n+"/"+i+" "+a+":"+o+":"+s;break;case"dd-mm-yyyy":u=r+"-"+n+"-"+i;break;case"dd-mm-yyyy hh:mm:ss":u=r+"-"+n+"-"+i+" "+a+":"+o+":"+s;break;case"iso-short":case"yyyy-mm-dd":u=i+"-"+n+"-"+r;break;case"iso":case"yyyy-mm-dd hh:mm:ss":u=i+"-"+n+"-"+r+" "+a+":"+o+":"+s;break;case"system":u=i+"-"+n+"-"+r+"T"+a+":"+o+":"+s+"Z";break;case"d M y hh:mm:ss":u=(u=this.displayDateString(n,r,i))+" "+a+":"+o+":"+s;break;case"d M y":default:u=this.displayDateString(n,r,i)}return u}return""},convertToLocalTime:function(e){var t="";if(e){var r=new Date(e),n=new Date(r.getTime()+60*r.getTimezoneOffset()*1e3),i=r.getTimezoneOffset()/60,a=r.getHours();n.setHours(a-i);t=n.toLocaleString({year:"numeric",day:"numeric",month:"short",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1})}return t},getDateWithTimeZone:function(e){var t=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3);return this.formatDateString(t,"yyyy-mm-dd hh:mm:ss")},getTodayDateObj:function(){var e=new Date,t=e.getDate(),r=e.getMonth()+1,n=e.getFullYear(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),s=this.getDateWithTimeZone(this.getDateObj(n,r,t,i,a,o)),u=function(e){return(e=parseInt(e))<10?"0"+e:e};return{date:e,day:t,month:r,year:n,hour:i,minute:a,second:o,displayDay:u(t),displayMonth:u(r),displayYear:u(n),displayHour:u(i),displayMinute:u(a),displaySecond:u(o),gmtDate:s}},dateValidator:function(e,t,r,n){var i="";if(e&&t&&r){var a=parseInt(r),o=parseInt(t),s=parseInt(e),u=new Date(a,o-1,s);if(u.getFullYear()===a&&u.getMonth()+1===o&&u.getDate()===s){if(a<1900&&(i=i18next.t("Year must be after 1900")),n){var c=new Date;u.setHours(0,0,0,0)>c.setHours(0,0,0,0)&&(i=i18next.t("The date must not be in the future."))}}else i=i18next.t("Invalid Date. Please enter a valid date.")}else i=i18next.t("Missing value.");return i}};t.a=n;var i=n.validateDateInputFields},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(0),o={biopsy:{code:"111",display:"biopsy"},pca_diag:{code:"121",display:"PCa diagnosis"},pca_localized:{code:"141",display:"PCa localized diagnosis"}};t.a={beforeSend:function(){$.ajaxSetup({beforeSend:function(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",$("#__CRSF_TOKEN").val())}})},sendRequest:function(e,t,r,i,a){if(!e)return!1;var o={type:t||"GET",url:e,attempts:0,max_attempts:3,contentType:"application/json; charset=utf-8",dataType:"json",sync:!1,timeout:5e3,data:null,useWorker:!1,async:!0};i=i||o,(i=$.extend({},o,i)).async=!i.sync&&i.async;var s=this,u=this.FieldLoaderHelper,c=i.targetField||null;if(a=a||function(){},i.attempts++,u.showLoader(c),i.useWorker&&window.Worker&&!n.a.isTouchDevice())return n.a.initWorker(e,i,function(t){var n;try{n=JSON.parse(t)}catch(t){return a({error:"Error occurred parsing data for "+e}),!1}n?n.error?(a({error:!0,data:n}),s.sendError(n,e,r,i),u.showError(c)):(a(n),u.showUpdate(c)):(a({error:!0,data:"no data returned"}),u.showError(c))}),!0;i.cache||(i.headers={"cache-control":"no-cache",expires:"-1",pragma:"no-cache"}),$.ajax(i).done(function(e){i.attempts=0,e?(u.showUpdate(c),a(e)):(u.showError(c),a({error:!0,data:"no data returned"}))}).fail(function(n){i.attempts<i.max_attempts?function(e,t,r,n,i,a){setTimeout(function(){e.sendRequest(t,r,n,i,a)},3e3)}(s,e,t,r,i,a):(i.attempts=0,u.showError(c),a({error:!0,data:n}),s.sendError(n,e,r,i))})},sendError:function(e,t,r,n){if(!e)return!1;var i="[Error occurred processing request]  status - "+(0===parseInt(e.status)?"request timed out/network error":e.status)+", response text - "+(e.responseText?e.responseText:"no response text returned from server");if(n)try{i+=" [data sent]: "+JSON.stringify(n)}catch(e){i+=" Error occurred transforming sent data: "+e.message}this.reportError(r||"Not available",t,i,!0)},reportError:function(e,t,r,n){var i={};i.subject_id=e||0,i.page_url=t||window.location.href,i.message="Error generated in JS - "+(r?r.replace(/["']/g,""):"no detail available"),window.console&&(console.log("Errors occurred....."),console.log(i)),$.ajax({type:"GET",url:"/report-error",contentType:"application/json; charset=utf-8",cache:!1,async:!n,data:i}).done(function(){}).fail(function(){})},FieldLoaderHelper:{delayDuration:300,showLoader:function(e){if(!e||0===e.length)return!1;var t=$("#"+(e.attr("data-save-container-id")||e.attr("id"))+"_load");t.css("opacity",1),t.addClass("loading")},showUpdate:function(e){var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),a=$("#"+r+"_load");a.removeClass("loading"),n.text("").css("opacity",0),i.text(i18next.t("success")),a.animate({opacity:0},t,function(){i.animate({opacity:1},t,function(){setTimeout(function(){i.animate({opacity:0},2*t)},2*t)})})}(e)},t)},showError:function(e){e=e||$(e);var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),a=$("#"+r+"_load");a.removeClass("loading"),n.text(i18next.t("Unable to update. System/Server Error.")),i.text("").css("opacity",0),a.animate({opacity:0},t,function(){n.animate({opacity:1},t,function(){setTimeout(function(){n.animate({opacity:0},2*t)},2*t)})})}(e)},t)}},getCurrentUser:function(e,t){e=e||function(){},sessionStorage.currentUser?e(JSON.parse(sessionStorage.currentUser)):this.sendRequest("/api/me","GET","",t,function(t){t&&t.id&&sessionStorage.setItem("currentUser",JSON.stringify(t)),e(t)})},getStillNeededCoreData:function(e,t,r,n){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var i="/api/coredata/user/"+e+"/still_needed"+(n?"?entry_method="+n.replace(/\_/g," "):"");this.sendRequest(i,"GET",e,{sync:t,cache:!0},function(e){return e?e.error?(r({error:i18next.t("unable to get needed core data")}),!1):void r(e):(r({error:i18next.t("no data returned")}),!1)})},getRequiredCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;this.sendRequest("/api/coredata/user/"+e+"/required","GET",e,{sync:t,cache:!0},function(e){e?e.error?r({error:i18next.t("unable to get required core data")}):e.required?r(e.required):r({error:i18next.t("no data returned")}):r({error:i18next.t("no data returned")})})},getOptionalCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var n="/api/coredata/user/"+e+"/optional",i="optionalCoreData_"+e;sessionStorage.getItem(i)?r(JSON.parse(sessionStorage.getItem(i))):this.sendRequest(n,"GET",e,t,function(e){r(e||{error:i18next.t("no data found")})})},getPortalFooter:function(e,t,r,n){if(n=n||function(){},!e)return n("<div class='error-message'>"+i18next.t("User Id is required")+"</div>"),!1;this.sendRequest("/api/portal-footer-html/","GET",e,{sync:t,cache:!0,dataType:"html"},function(e){e?e.error?n("<div class='error-message'>"+i18next.t("Unable to retrieve portal footer html")+"</div>"):(r&&$("#"+r).html(e),n(e)):n("<div class='error-message'>"+i18next.t("No data found")+"</div>")})},getOrgs:function(e,t,r){r=r||function(){},this.sendRequest("/api/organization","GET",e,t,function(e){if(sessionStorage.demoOrgsData)return r(JSON.parse(sessionStorage.demoOrgsData)),!0;if(e.error){var t=i18next.t("Server error occurred retrieving organization/clinic information.");$(".get-orgs-error").html(t),r({error:t})}else $(".get-orgs-error").html(""),sessionStorage.setItem("demoOrgsData",JSON.stringify(e)),r(e)})},getConsent:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/consent","GET",e,t,function(e){if(e){if(e.error){var t=i18next.t("Server error occurred retrieving consent information.");return r({error:t}),$(".get-consent-error").html(t),!1}return $(".get-consent-error").html(""),r(e),!0}})},setConsent:function(e,t,r,n,i){if(i=i||function(){},!e&&!t)return i({error:i18next.t("User id and parameters are required")}),!1;var a="/api/user/"+e+"/consent";if(!this.hasConsent(e,t.org,r)||t.testPatient){var o={};o.user_id=e,o.organization_id=t.org,o.agreement_url=t.agreementUrl,o.staff_editable="null"!==String(t.staff_editable)&&"undefined"!==String(t.staff_editable)&&t.staff_editable,o.include_in_reports="null"!==String(t.include_in_reports)&&"undefined"!==String(t.include_in_reports)&&t.include_in_reports,o.send_reminders="null"!==String(t.send_reminders)&&"undefined"!==String(t.send_reminders)&&t.send_reminders,t.acceptance_date&&(o.acceptance_date=t.acceptance_date),this.sendRequest(a,"POST",e,{sync:n,data:JSON.stringify(o)},function(e){if(e.error){var t=i18next.t("Server error occurred setting consent status.");i({error:t}),$(".set-consent-error").html(t)}else $(".set-consent-error").html(""),i(e)})}else i({error:!1})},deleteConsent:function(e,t){if(!e||!t)return!1;var r=this.getAllValidConsent(e,t.org);if(!r)return!1;var n=t.exclude?t.exclude.split(","):[],i=$.grep(r,function(e){return!$.grep(n,function(t){return String(t)===String(e)}).length}),a=this;i.forEach(function(t){a.sendRequest("/api/user/"+e+"/consent","DELETE",e,{data:JSON.stringify({organization_id:parseInt(t)})},function(e){if(!e)return!1;e.error?$(".delete-consent-error").html(i18next.t("Server error occurred removing consent.")):$(".delete-consent-error").html("")})})},withdrawConsent:function(e,t,r,n){if(n=n||function(){},!e||!t)return n({error:i18next.t("User id and organization id are required.")}),!1;r=r||{};var a=this,o=[];this.sendRequest("/api/user/"+e+"/consent","GET",e,r,function(s){if(s&&s.consent_agreements&&s.consent_agreements.length>0&&(o=$.grep(s.consent_agreements,function(e){var r=e.expires?i.a.getDateDiff(String(e.expires)):0;return!(String(t)!==String(e.organization_id)||e.deleted||r>0||"suspended"!==String(e.status))})),o.length>0)return n({data:"success"}),!1;a.sendRequest("/api/user/"+e+"/consent/withdraw","POST",e,{sync:r.sync,data:JSON.stringify({organization_id:t})},function(e){if(e.error)return n({error:i18next.t("Error occurred setting suspended consent status.")}),!1;n(e)})})},getAllValidConsent:function(e,t){if(!e||!t)return!1;var r=[];return this.sendRequest("/api/user/"+e+"/consent","GET",e,{sync:!0},function(e){return e&&!e.error&&e.consent_agreements&&0!==e.consent_agreements.length?r=(r=$.grep(e.consent_agreements,function(e){var r=e.expires?i.a.getDateDiff(String(e.expires)):0;return!(e.deleted||r>0||"all"!==String(t).toLowerCase()&&String(t)!==String(e.organization_id))})).map(function(e){return e.organization_id}):r}),r},hasConsent:function(e,t,r){if(!e||!t||"default"===String(r))return!1;var n=[],a="/api/user/"+e+"/consent";return this.sendRequest(a,"GET",e,{sync:!0},function(e){if(!e||e.error||e.consent_agreements&&0===e.consent_agreements.length)return!1;n=$.grep(e.consent_agreements,function(e){var r=e.expires?i.a.getDateDiff(String(e.expires)):0;return String(t)===String(e.organization_id)&&!e.deleted&&!(r>0)&&e.staff_editable&&e.send_reminders&&e.include_in_reports})}),n.length},getDemo:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;t=t||{};var n="demoData_"+e;sessionStorage.getItem(n)?r(JSON.parse(sessionStorage.getItem(n))):this.sendRequest("/api/demographics/"+e,"GET",e,t,function(e){var t="";if(e.error)return t=i18next.t("Server error occurred retrieving demographics information."),$(".get-demo-error").html(t),r({error:t}),!1;$(".get-demo-error").html(t),sessionStorage.setItem(n,JSON.stringify(e)),r(e)})},clearDemoSessionData:function(e){sessionStorage.removeItem("demoData_"+e)},putDemo:function(e,t,r,n,i){if(i=i||function(){},!e)return i({error:i18next.t("User Id is required")}),!1;this.clearDemoSessionData(e),this.sendRequest("/api/demographics/"+e,"PUT",e,{sync:n,data:JSON.stringify(t),targetField:r},function(e){e.error?$(".put-demo-error").html(i18next.t("Server error occurred setting demographics information.")):$(".put-demo-error").html(""),i(e)})},getLocale:function(e){this.sendRequest("/api/demographics/"+e,"GET",e,null,function(e){e&&(e.error?$("#profileLocaleTimezoneContainer .get-locale-error").html(i18next.t("Server error occurred retrieving locale information.")):e.communication&&$("#profileLocaleTimezoneContainer .get-locale-error").html(""))})},hasTreatment:function(e){if(!e||!e.entry||0===e.entry.length)return!1;var t=e.entry.sort(function(e,t){return new Date(t.resource.meta.lastUpdated)-new Date(e.resource.meta.lastUpdated)}),r=!1;return t.forEach(function(e){if(r)return!0;var t=String(e.resource.code.coding[0].code),n=String(e.resource.code.coding[0].system),i=e.resource.id;(t===a.a.CANCER_TREATMENT_CODE&&n===a.a.SNOMED_SYS_URL||t===a.a.NONE_TREATMENT_CODE&&n===a.a.CLINICAL_SYS_URL)&&(r={code:t,id:i})}),r},getTreatment:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,t,function(e){e.error&&$("#userProcedures").html("<span class='error-message'>"+i18next.t("Error retrieving data from server")+"</span>"),r(e)})},postTreatment:function(e,t,r,n){if(!e)return!1;this.deleteTreatment(e,n);var i=a.a.NONE_TREATMENT_CODE,o="None",s=a.a.CLINICAL_SYS_URL;if(t&&(i=a.a.CANCER_TREATMENT_CODE,o="Procedure on prostate",s=a.a.SNOMED_SYS_URL),!r){var u=new Date;r=u.getFullYear()+"-"+(u.getMonth()+1)+"-"+u.getDate()}var c=[{code:i,display:o,system:s}],d={resourceType:"Procedure"};d.subject={reference:"Patient/"+e},d.code={coding:c},d.performedDateTime=r||"",this.postProc(e,d,n)},deleteTreatment:function(e,t){var r=this;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,{sync:!0},function(e){if(!e||e.error)return!1;var n=r.hasTreatment(e);return!!n&&(String(n.code)===String(a.a.CANCER_TREATMENT_CODE)?(r.deleteProc(n.id,t,!0),!0):void r.deleteProc(n.id,t,!0))})},getProc:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/procedure","GET",e,null,function(e){r(e)})},postProc:function(e,t,r,n){n=n||function(){},this.sendRequest("/api/procedure","POST",e,{data:JSON.stringify(t),targetField:r},function(e){if(!e)return n({error:i18next.t("no data returned")}),!1;if(e.error){var t=i18next.t("Server error occurred saving procedure/treatment information.");return $("#userProcuedures .get-procs-error").html(t),n({error:t}),!1}$(".get-procs-error").html(""),n(e)})},deleteProc:function(e,t,r){this.sendRequest("/api/procedure/"+e,"DELETE",null,{sync:r,targetField:t},function(e){e.error?$(".del-procs-error").html(i18next.t("Server error occurred removing procedure/treatment information.")):$(".del-procs-error").html("")})},getRoleList:function(e,t){this.sendRequest("/api/roles","GET",null,e,function(e){if(t=t||function(){},e.error){var r=i18next.t("Server error occurred retrieving roles information.");$(".get-roles-error").html(r),t({error:r})}else t(e)})},getRoles:function(e,t,r){t=t||function(){};var n="userRole_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));t(i)}else this.sendRequest("/api/user/"+e+"/roles","GET",e,r,function(e){if(e)if(e.error){var r=i18next.t("Server error occurred retrieving user role information.");$(".get-roles-error").html(r),t({error:r})}else $(".get-roles-error").html(""),sessionStorage.setItem(n,JSON.stringify(e)),t(e)})},removeCachedRoles:function(e){sessionStorage.removeItem("userRole_"+e)},putRoles:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User Id is required.")}),!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e+"/roles","PUT",e,{data:JSON.stringify(t),targetField:r},function(t){if(!t||t.error){var r=i18next.t("Server error occurred setting user role information.");return $(".put-roles-error").html(r),void n({error:r})}$(".put-roles-error").html(""),sessionStorage.setItem("userRole_"+e,""),n(t)})},deleteRoles:function(e,t){if(!e)return!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e,"GET",e,{data:JSON.stringify(t)},function(e){e&&(e.error?$(".delete-roles-error").html(i18next.t("Server error occurred deleting user role.")):$(".delete-roles-error").html(""))})},getClinical:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/clinical","GET",e,t,function(e){if(e)if(e.error){var t=i18next.t("Server error occurred retrieving clinical data.");$(".get-clinical-error").html(t),r({error:t})}else $(".get-clinical-error").html(""),r(e)})},getObservationId:function(e,t){if(!e)return!1;var r="",n="";return this.sendRequest("/api/patient/"+e+"/clinical","GET",e,{sync:!0},function(e){e&&(e.error||e.entry&&e.entry.forEach(function(e){r||(n=e.content.code.coding[0].code,String(n)===String(t)&&(r=e.content.id))}))}),r},postClinical:function(e,t,r,n,i,s,u){if(!e)return!1;s=s||{};var c="",d="";if(o.hasOwnProperty(String(t).toLowerCase())){var l=o[t];c=l.code,d=l.display}if(!c)return!1;var f="POST",p="/api/patient/"+e+"/clinical",g=[{code:c,display:d,system:a.a.CLINICAL_SYS_URL}],h={resourceType:"Observation"};h.code={coding:g},h.issued=s.issuedDate?s.issuedDate:"",h.status=n||"",h.valueQuantity={units:"boolean",value:r},s.performer&&(h.performer=s.performer);var m=this.getObservationId(e,c);m&&(f="PUT",p=p+"/"+m),u=u||function(){},this.sendRequest(p,f,e,{data:JSON.stringify(h),targetField:i},function(e){if(!e||e.error){var t=i18next.t("Server error occurred updating clinical data.");return $(".post-clinical-error").html(t).show(),void u({error:t})}$(".post-clinical-error").html("").hide(),u(e)})},getTermsUrl:function(e,t){t=t||function(){},this.sendRequest("/api/tou","GET",null,{sync:e},function(e){e&&(e.error?($(".get-tou-error").html(i18next.t("Server error occurred retrieving tou url.")),t({error:i18next.t("Server error")})):($(".get-tou-error").html(""),e.url?($("#termsURL").attr("data-url",e.url),$("#termsCheckbox_default .terms-url").attr("href",e.url),t({url:e.url})):t({error:i18next.t("no url returned")})))})},getInstrumentsList:function(e,t){t=t||function(){},this.sendRequest("api/questionnaire_bank","GET",null,{sync:e},function(e){if(e)if(e.error)t({error:i18next.t("error retrieving instruments list")});else if(e.entry)if(0===e.entry.length)t({error:i18next.t("no data returned")});else{var r={};e.entry.forEach(function(e){if(e.organization){var t=e.organization.reference.split("/")[2];r[t]||(r[t]=[]),e.questionnaires&&e.questionnaires.forEach(function(e){-1===$.inArray(e.questionnaire.display,r[t])&&r[t].push(e.questionnaire.display)})}}),t(r)}else t({error:i18next.t("no data returned")})})},getTerms:function(e,t,r,n,i){n=n||function(){},i=i||{};var a="/api/user/{userId}/tou{type}{all}".replace("{userId}",e).replace("{type}",t?"/"+t:"").replace("{all}",i.hasOwnProperty("all")?"?all=true":"");this.sendRequest(a,"GET",e,{sync:r},function(e){if(e)if(e.error){var t=i18next.t("Server error occurred retrieving tou data.");$(".get-tou-error").html(t),n({error:t})}else $(".get-tou-error").html(""),n(e)})},postTermsByUser:function(e,t,r){r=r||function(){},this.sendRequest("/api/user/"+e+"/tou/accepted","POST",e,{data:JSON.stringify(t)},function(e){if(!e||e.error)return $(".post-tou-error").html(i18next.t("Server error occurred saving terms of use information.")),void r(e);$(".post-tou-error").html(""),r(e)})},postTerms:function(e,t,r){r=r||function(){},this.sendRequest("/api/tou/accepted","POST",null,{data:JSON.stringify(e),targetField:t},function(e){if(!e||e.error){var t=i18next.t("Server error occurred saving terms of use information.");return $(".post-tou-error").html(t),void r({error:t})}$(".post-tou-error").html(""),r(e)})},accessUrl:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/access_url","GET",e,{sync:t},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving access url.")}):r({url:e.access_url}):r({error:i18next.t("no data returned")})})},invite:function(e,t,r){if(r=r||function(){},!t)return r({error:i18next.t("Invite data are required.")}),!1;this.sendRequest("/invite","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:t,dataType:"html"},function(e){r(e||{error:i18next.t("no data returned")})})},passwordReset:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/password_reset","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"},function(e){e?e.error?t({error:i18next.t("Error occurred sending password reset request.")}):t(e):t({error:i18next.t("no data returned")})})},assessmentStatus:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment-status","GET",e,null,function(e){e?e.error?t({error:i18next.t("Error occurred retrieving assessment status.")}):t(e):t({error:i18next.t("no data returned")})})},updateAssessment:function(e,t,r){return r=r||function(){},e?t?void this.sendRequest("/api/patient/"+e+"/assessment","PUT",e,{data:JSON.stringify(t)},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})}):(r({error:i18next.t("Questionnaire response data is required.")}),!1):(r({error:i18next.t("User id is required.")}),!1)},assessmentList:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})})},assessmentReport:function(e,t,r){if(r=r||function(){},!e||!t)return r({error:i18next.t("User id and instrument Id are required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment/"+t,"GET",e,null,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment report.")}):r(e):r({error:i18next.t("no data returned")})})},getCurrentQB:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User id is required.")}),!1;r=r||{},this.sendRequest("/api/user/"+e+"/questionnaire_bank","GET",e,{data:{as_of_date:t},sync:!!r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred retrieving current questionnaire bank for user.")}),!1;n(e)})},patientReport:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/user_documents?document_type=PatientReport","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving patient report.")}):r(e):r({error:i18next.t("no data returned")})})},setTablePreference:function(e,t,r,n){if(n=n||function(){},!e||!t)return n({error:"User Id and table name is required for setting preference."}),!1;r=r||{},this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"PUT",e,{data:r.data,sync:r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred setting table preference.")}),!1;n(e)})},getTablePreference:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(!e||!t)return n({error:"User Id and table name is required for setting preference."}),!1;this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"GET",e,{sync:r.sync},function(e){e?e.error?n({error:i18next.t("Error occurred setting table preference.")}):n(e):n({error:i18next.t("no data returned")})})},emailLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/messages","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving email audit entries.")}):r(e):r({error:i18next.t("no data returned")})})},auditLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/audit","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving audit log.")}):r(e):r({error:i18next.t("no data returned")})})},setting:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("configuration key is required.")}),!1;r=r||{},this.sendRequest("/api/settings/"+e,"GET",t,{sync:r.sync},function(e){e?e.error?n({error:i18next.t("Error occurred retrieving content for configuration key.")}):n(e):n({error:i18next.t("no data returned")})})},deactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e,"DELETE",e,t||{},function(e){r=r||function(){},e&&!e.error?r(e):r({error:i18next.t("Error occurred deactivating user.")})})},reactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e+"/reactivate","POST",e,t||{},function(e){e&&!e.error?r(e):r({error:i18next.t("Error occurred reactivating user.")})})},getConfigurationByKey:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("configuration variable name is required.")}),!1;var n="config_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));return r(i),!0}this.sendRequest("/api/settings/"+e,"GET",null,t||{},function(t){t?(r(t),t.hasOwnProperty(e)&&sessionStorage.setItem(n,JSON.stringify(t))):r({error:i18next.t("no data returned")})})},getConfiguration:function(e,t,r){r=r||function(){};var n="settings_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));r(i)}else this.sendRequest("/api/settings","GET",e,t||{},function(e){e?(r(e),sessionStorage.setItem(n,JSON.stringify(e))):r({error:i18next.t("no data returned")})})},getEmailReady:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/email_ready","GET",e,t,function(e){r(e)})}}},,,,,,,,,,,function(e,t,r){"use strict";r.r(t);var n,i=r(3),a=r(2),o=r(0);n=window.psaApp=new Vue({el:"#mainPsaApp",components:{"refresh-icon":{props:["title"],template:"<span class='glyphicon glyphicon-refresh refresh' aria-hidden='true' v-on:click='$emit(\"refresh\")' v-bind:title='title'></span>"},"filter-control":{props:["id","prompt","selectedvalue","items"],template:"<select v-bind:id='id' class='form-control filter-control' v-on:change='$emit(\"changeevent\", $event)'><option value='' class='select-option'>{{prompt}}</option><option v-bind:value='item' v-for='item in items' v-bind:selected='item == selectedvalue'>{{item}}</option></select>"}},errorCaptured:function(e,t,r){return console.error("Error: ",e," Component: ",t," Message: ",r),!1},errorHandler:function(e,t){this.dataError=!0;var r=document.getElementById("psaTrackerErrorMessageContainer");r&&(r.innerHTML="Error occurred initializing PSA Tracker Vue instance."),window.console&&(console.warn("PSA Tracker Vue instance threw an error: ",t,this),console.error("Error thrown: ",e))},created:function(){if("undefined"==typeof Vue)return!1;var e=this;Vue.config.errorHandler=function(t,r,n){var i,a=r;if(r.$options.errorHandler)i=r.$options.errorHandler;else for(;!i&&a.$parent;)i=(a=a.$parent).$options.errorHandler;e.restoreVis(),i?i.call(a,t,r,n):console.log(t)}},data:{userId:"",userIdKey:"psaTracker_currentUser",clinicalCode:"666",clinicalDisplay:"psa",clinicalSystem:"http://us.truenth.org/clinical-codes",loading:!1,savingInProgress:!1,addErrorMessage:"",noResultMessage:i18next.t("No PSA results to display"),editText:i18next.t("Edit"),saveText:i18next.t("Save"),closeText:i18next.t("Close"),filterText:i18next.t("Filter"),yLegendText:i18next.t("Result (ng/ml)"),xLegendText:i18next.t("PSA Test Date"),MAX_RESULT:1e4,treatmentEditUrl:"profile#profileProceduresWrapper",newItem:{id:"",result:"",date:"",edit:!1},headers:[i18next.t("Date"),i18next.t("PSA (ng/ml)")],intro:{header:i18next.t("Track Your PSA"),body:i18next.t("Prostate-specific antigen, or PSA, is a protein produced by cells of the prostate gland. The PSA test measures the level of PSA in a man's blood. For this test, a blood sample is sent to a laboratory for analysis. The results are reported as nanograms of PSA per milliliter (ng/mL) of blood."),addText:i18next.t("ADD NEW PSA RESULT")},fields:{resultLabel:i18next.t("PSA (ng/ml)"),dateLabel:i18next.t("PSA Test Date"),resultPlaceholder:i18next.t("Enter a number"),datePlaceholder:i18next.t("d M yyyy, example: 1 Jan, 2017")},items:[],history:{title:i18next.t("PSA Result History"),items:[],buttonLabel:i18next.t("History"),sidenote:""},originals:[],resultRange:["<= 4",">= 2",">= 3",">= 4",">= 5"],RANGE_ENUM:{"<= 4":function(e){return $.grep(e,function(e){return e.result<=4})},">= 2":function(e){return $.grep(e,function(e){return e.result>=2})},">= 3":function(e){return $.grep(e,function(e){return e.result>=3})},">= 4":function(e){return $.grep(e,function(e){return e.result>=4})},">= 5":function(e){return $.grep(e,function(e){return e.result>=5})}},filters:{filterYearPrompt:i18next.t("Filter By Year"),filterResultPrompt:i18next.t("Filter By Result"),selectedFilterYearValue:"",selectedFilterResultRange:"",clearLabel:i18next.t("Clear Filters")},showRefresh:!1,treatment:{treatmentTextPrompt:i18next.t("Last Received Treatment:"),treatmentDatePrompt:i18next.t("Treatment Date:"),noTreatmentText:i18next.t("No treatment received as of today"),data:[]},modalLoading:!1,editLink:i18next.t("Edit"),editTitle:i18next.t("Edit PSA Result"),addTitle:i18next.t("Add PSA Result")},computed:{yearList:function(){var e=this.originals.map(function(e){return e.titleYear});return e=$.grep(e,function(t,r){return e.indexOf(t)===r}),e}},methods:{init:function(e){var t=this;for(var r in e=e||{})e.hasOwnProperty(r)&&(t[r]=e[r]);sessionStorage.removeItem(this.userIdKey),this.getData(!0),this.getProcedure(),setTimeout(function(){t.initElementsEvents()},300)},isActedOn:function(){return this.showRefresh&&(""!==this.filters.selectedFilterYearValue||""!==this.filters.selectedFilterResultRange)},restoreVis:function(){var e=document.getElementById("loadingIndicator"),t=document.getElementById("mainHolder");e&&e.setAttribute("style","display:none; visibility:hidden;"),t&&t.setAttribute("style","visibility:visible;-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=100)';filter:alpha(opacity=100); -moz-opacity:1; -khtml-opacity:1; opacity:1")},isEdit:function(){return this.newItem.edit},refresh:function(){this.clearFilter(),this.getData()},getAddModalTitle:function(){return this.newItem.edit?this.editTitle:this.addTitle},getRefreshMessage:function(){return i18next.t("Click to reload the page and try again.")},validateResult:function(e){var t=!(isNaN(e)||parseInt(e)<0||parseInt(e)>this.MAX_RESULT);return t?(this.addErrorMessage="",t):(this.addErrorMessage=i18next.t("Result must be a number and within valid range (less than {max_result}).").replace("{max_result}",this.MAX_RESULT),!1)},validateDate:function(e){if(!e||e.length<=9)return!1;var t=this.tnthDates.isValidDefaultDateFormat(e);return this.addErrorMessage=t?"":i18next.t("Date must be in the valid format."),t},formatDateString:function(e,t){return this.tnthDates.formatDateString(e,t)},initElementsEvents:function(){var e=this;$("#psaDate").datepicker({format:"d M yyyy",forceParse:!1,endDate:new Date,maxViewMode:2,autoclose:!0}).on("hide",function(){$("#psaDate").trigger("blur")}),$("#psaDate").on("change blur",function(){var t=$(this).val();if(!t||!e.validateDate(t))return!1;e.newItem.date=t}).on("focus",function(){e.modalLoading=!1}),$("#psaResult").on("blur",function(){e.validateResult($(this).val())}),$("#psaTrackerBtnAddNew").on("click",function(){e.clearNew()}),this.convertToNumericField($("#psaResult")),$("#addPSAModal").on("show.bs.modal",function(){e.modalLoading=!0}),$("#addPSAModal").on("shown.bs.modal",function(){$("#psaResult").focus(),$("#psaDate").datepicker("update",e.newItem.date||new Date),setTimeout(function(){e.modalLoading=!1},50)}),$("#psaTrackerResultsTable .result-row").on("mouseover",function(){$(this).addClass("edit")}).on("mouseout",function(){$(this).removeClass("edit")})},convertToNumericField:function(e){e&&("ontouchstart"in window||void 0!==window.DocumentTouch&&document instanceof window.DocumentTouch)&&e.each(function(){$(this).prop("type","tel")})},getCurrentUserId:function(){var e=this;return sessionStorage.getItem(this.userIdKey)||this.tnthAjax.sendRequest("/api/me","GET","",{sync:!0},function(t){t.error?sessionStorage.setItem(e.userIdKey,$("#psaTracker_currentUser").val()):sessionStorage.setItem(e.userIdKey,t.id)}),sessionStorage.getItem(this.userIdKey)},getExistingItemByDate:function(e){var t=this.tnthDates.formatDateString(e,"iso-short"),r=this;return $.grep(this.items,function(e){return t===r.tnthDates.formatDateString(e.date,"iso-short")})},onEdit:function(e){if(e){for(var t in this.newItem)this.newItem.hasOwnProperty(t)&&(this.newItem[t]=e[t]);setTimeout(function(){$("#addPSAModal").modal("show")},250)}},isValidData:function(){var e=this.newItem.date,t=this.newItem.result;return e&&this.validateDate(e)&&t&&this.validateResult(t)},onAdd:function(){if(!this.isValidData())return!1;this.addErrorMessage="";var e=this.getExistingItemByDate(this.newItem.date);e.length>0&&(this.newItem.id=e[0].id),this.postData()},getProcedure:function(){var e=this;this.tnthAjax.getProc(this.getCurrentUserId(),!1,function(t){if(!t)return!1;t.entry=t.entry||[];var r=$.grep(t.entry,function(e){var t=e.resource.code.coding[0].code;return t!==o.a.CANCER_TREATMENT_CODE&&t!==o.a.NONE_TREATMENT_CODE});if(0===r.length)return!1;r.sort(function(e,t){return new Date(t.resource.performedDateTime)-new Date(e.resource.performedDateTime)}),e.treatment.data=[r.map(function(t){return{display:t.resource.code.coding[0].display,date:e.formatDateString(t.resource.performedDateTime.substring(0,19),"d M y")}})[0]]})},showTreatment:function(){return this.treatment.data.length>0},getData:function(){var e=this;this.loading=!0,this.tnthAjax.getClinical(this.getCurrentUserId(),{data:{patch_dstu2:!0}},function(t){if(t.error)return $("#psaTrackerErrorMessageContainer").html(i18next.t("Error occurred retrieving PSA result data")),e.loading=!1,!1;if(!t.entry)return $("#psaTrackerErrorMessageContainer").html(i18next.t("No result data found")),e.loading=!1,!1;var r=t.entry.map(function(t){var r={},n=t.resource,i=n.code.coding[0];return t.updated=t.updated||"",r.id=n.id,r.code=i.code,r.display=i.display,r.updated=e.formatDateString(t.updated.substring(0,19),"yyyy-mm-dd hh:mm:ss"),r.date=n.issued?e.formatDateString(n.issued.substring(0,19),"d M y"):"",r.result=n.valueQuantity.value,r.edit=!0,r.titleYear=new Date(n.issued).getFullYear(),r});if((r=(r=$.grep(r,function(e){return"psa"===e.display.toLowerCase()})).sort(function(e,t){return new Date(t.date)-new Date(e.date)})).length>10){var n=r;r=r.slice(0,10),e.history.items=n.slice(10,20),e.history.sidenote=String(i18next.t("* Maximum of {resultNumber} results since {year}")).replace("{resultNumber}",10).replace("{year}",e.getHistoryMinYear())}0===r.length&&(e.noResultMessage=i18next.t("No PSA results to display")),e.items=e.originals=r,e.filterData(),setTimeout(function(){e.drawGraph(),e.loading=!1},500),$("#psaTrackerErrorMessageContainer").html("")})},showHistory:function(){$("#PSAHistoryModal").modal("show")},getHistoryMinYear:function(){if(0===this.history.items.length)return!1;var e=this.history.items.map(function(e){return new Date(e.date).getFullYear()});return e.sort(function(e,t){return e-t}),e[0]},clearFilter:function(){this.filters.selectedFilterResultRange="",this.filters.selectedFilterYearValue=""},filterData:function(e){var t=this.originals,r=this;if(this.items=this.originals,""!==this.filters.selectedFilterYearValue&&(t=$.grep(t,function(e){return parseInt(e.titleYear)===parseInt(r.filters.selectedFilterYearValue)}),this.items=t),this.filters.selectedFilterResultRange&&(this.items=this.RANGE_ENUM[this.filters.selectedFilterResultRange](this.items)),0===this.items.length&&this.isActedOn()&&(this.noResultMessage=i18next.t("No PSA result matching the filtering criteria. Please try again.")),!e)return!1;setTimeout(function(){r.drawGraph()},500)},filterDataByYearEvent:function(e){this.showRefresh=!0,this.filters.selectedFilterYearValue=e.target.value,this.filterData(!0)},filterDataByResultEvent:function(e){this.showRefresh=!0,this.filters.selectedFilterResultRange=e.target.value,this.filterData(!0)},showFilters:function(){return this.originals.length>1},postData:function(){var e="",t=this,r=this.getCurrentUserId();if(this.newItem.date){var n=new Date(this.newItem.date);e=[n.getFullYear(),n.getMonth()+1,n.getDate()].join("-"),e+="T12:00:00"}var i="/api/patient/"+r+"/clinical",a="POST",o=[{code:this.clinicalCode,display:this.clinicalDisplay,system:this.clinicalSystem}],s={resourceType:"Observation"};s.code={coding:o},s.issued=e,s.valueQuantity={units:"g/dl",code:"g/dl",value:this.newItem.result},this.newItem.id&&(a="PUT",i=i+"/"+this.newItem.id),this.savingInProgress=!0,this.tnthAjax.sendRequest(i,a,r,{data:JSON.stringify(s),async:!0},function(e){e.error?t.addErrorMessage=i18next.t("Server error occurred adding PSA result."):($("#addPSAModal").modal("hide"),t.clearFilter(),t.getData(),t.addErrorMessage=""),setTimeout(function(){t.savingInProgress=!1},550)})},clearNew:function(){for(var e in this.newItem)this.newItem.hasOwnProperty(e)&&(this.newItem[e]="");$("#psaDate").datepicker("update","")},__handleTreatmentDate:function(e,t,r){if(0===this.treatment.data.length)return!1;r=Math.floor(r/2);var n=new Date(this.treatment.data[0].date);if(n.getTime()<e.getTime()){var i=new Date(e);return new Date(i.setUTCDate(i.getUTCDate()-r))}if(n.getTime()>t.getTime()){var a=new Date(t);return new Date(a.setUTCDate(a.getUTCDate()+r))}return n},getNearestPow10:function(e){var t=Math.log(e)/Math.LN10;return t>=Math.ceil(t)-.1?t+=1:t=Math.ceil(t),Math.pow(10,t)},getRange:function(e,t,r){var n=[];e=e||10,r=r||1;for(var i=t=t||0;i<e;i++)n.push(r*i);return n},getDayInMiliseconds:function(){return 864e5},getInterval:function(e,t,r){if(r=r||8,!t||!e)return r;var n=this.getDayInMiliseconds(),i=(new Date(t)-new Date(e))/n;return Math.ceil(i/r)},dateTicks:function(e,t){var r,n=new Date(e),i=new Date(t),a=[],o=this.getInterval(e,t,7)||7;for(n.setUTCDate(n.getUTCDate()),i.setUTCDate(i.getUTCDate());n<=i;)r=new Date(n),n.setUTCDate(n.getUTCDate()+o),a.push(r),n>i&&a.push(new Date(i));return a},setLetterSpacing:function(e){e=e||"";for(var t="0 ",r=1;r<e.length;r++)/\s/.test(e.charAt(r))?t+="3 ":t+="2 ";return t},drawGraph:function(){$("#psaTrackerGraph").html("");var e=this,t=e.d3,r=50,n=40,i=70,a=70,o=640-a-n,s=430-r-i,u=t.time.format("%d %b %Y"),c=u.parse,d=e.items;d.forEach(function(e){e.graph_date=c(e.date),e.result=isNaN(e.result)?.1:+e.result});var l=t.min(d,function(e){return e.graph_date}),f=t.max(d,function(e){return e.graph_date}),p=t.max(d,function(e){return e.result}),g=t.extent(d,function(e){return e.graph_date}),h=(o-a-n)/7,m=t.time.scale().range([h,o-h]),y=t.scale.log().range([s,0]);if(d.length<=2||String(l)===String(f)){var v=new Date(f);g=[l,f=new Date(v.setDate(v.getDate()+365))]}var x=e.getNearestPow10(p);m.domain(g),y.domain([.1,x]);var T=t.svg.axis().scale(m).orient("bottom").ticks(e.dateTicks).tickSize(0,0,0).tickFormat(u),S=t.svg.axis().scale(y).ticks(10).orient("left").tickSize(0,0,0),E=t.svg.line().x(function(e){return m(e.graph_date)}).y(function(e){return y(e.result)}),D=t.select("#psaTrackerGraph").append("svg").attr("width",o+a+n).attr("height",s+r+i),w=D.append("g").attr("transform","translate("+a+","+r+")");w.append("g").attr("class","x axis x-axis").attr("transform","translate(0,"+(s+5)+")").call(T).selectAll("text").call(function(e){e.each(function(){var e=t.select(this),r=e.text().split(/\s+/);e.text(null).append("tspan").attr("x",0).attr("y",e.attr("y")).attr("dx","-1.25em").attr("dy",e.attr("dy")).text(r[0]+" "+r[1]),e.append("tspan").attr("x",0).attr("y",e.attr("y")).attr("dx","-1em").attr("dy","2em").text(r[2])})}).attr("y",0).attr("x",7).attr("dy",".35em").attr("class","axis-stroke").style("letter-spacing","1px").style("text-anchor","start"),w.append("g").attr("class","grid grid-x").attr("transform","translate(0,"+s+")").call(T.tickSize(-s,0,0).tickFormat("")),w.append("g").attr("class","grid grid-y").call(S.tickSize(-o,0,0).tickValues(function(){return e.getRange(Math.log(x),-1,.5).map(function(e){return Math.pow(10,e)})}).tickFormat(function(e){return e===parseInt(e)?e:""})).selectAll("text").attr("dx","-2px").attr("dy","6px").attr("class","axis-stroke").style("text-anchor","end");D.append("path").attr("d","M "+a+" "+r+" V "+(430-i)+" H"+(640-n)).style("stroke","#3F4B54").style("stroke-width","1"),D.append("path").attr("d","M "+a+" "+r+" H "+(640-n)+" V "+(430-i)).style("stroke","#3F4B54").style("stroke-width","0.5");var R=t.select("body").append("div").attr("class","tooltip").style("opacity",0),_=e.__handleTreatmentDate(l,f,e.getInterval(l,f,7));if(_){w.append("path").attr("d","M"+m(_)+" 0 V "+s+" Z").style("stroke","#EF425C").style("stroke-dasharray","1, 5").style("stroke-width","2"),w.append("use").attr("x",m(_)-2).attr("y",-2).attr("xlink:href","#marker"),w.append("use").attr("x",m(_)+6).attr("y",s-6).attr("xlink:href","#arrow");w.append("rect").attr("x",m(_)-38).attr("y",25).attr("width",76).attr("height",25).style("stroke","#EF425C").style("stroke-width","0.5").style("fill","#EF425C"),w.append("text").attr("x",m(_)).attr("y",41).attr("text-anchor","middle").attr("font-size","11px").style("stroke-width","4px").style("fill","#FFF").style("letter-spacing","2px").text(i18next.t("treatment"))}w.append("path").attr("class","line").style("stroke","#bec0c1").style("stroke-width",2).attr("d",E(d));w.selectAll("circle").data(d).enter().append("circle").transition().duration(850).delay(function(e,t){return 7*t}).style("stroke","#809EAE").style("stroke-width",2).attr("r",7.7).attr("class","circle").attr("cx",function(e){return m(e.graph_date)}).attr("cy",function(e){return y(e.result)}),w.selectAll("circle").on("mouseover",function(e){var r=t.select(this);r.transition().duration(100).attr("r",9.24),r.style("fill","#809EAE").classed("focused",!0);var n=8*String(e.date).length+10;R.transition().duration(200).style("opacity",.9),R.html("<b>"+i18next.t("PSA")+"</b> "+e.result+"<br/><span class='small-text'>"+e.date+"</span>").style("width",n+"px").style("height","35px").style("left",t.event.pageX-n/2+"px").style("top",t.event.pageY-n/2+"px")}).on("mouseout",function(){var e=t.select(this);e.transition().duration(100).attr("r",7.7),e.style("stroke","#809EAE").style("fill","#FFF").classed("focused",!1),R.transition().duration(500).style("opacity",0)}),w.selectAll("text.text-label").data(d).enter().append("text").classed("text-label",!0).attr("x",function(e){return m(e.graph_date)}).attr("y",function(e){return y(e.result)}).attr("text-anchor","middle").attr("dy","-1.35em").attr("font-size","11px").style("stroke-width","2").attr("font-weight","500").attr("letter-spacing","2px").attr("fill","#656F76").text(function(e){return e.result}),w.append("text").attr("x",o/2).attr("y",0-r/2).attr("text-anchor","middle").attr("class","graph-caption").text("PSA (ng/ml)"),w.append("g").attr("transform","translate("+(o/2-a+n-20)+","+(s+i-i/5)+")").append("text").text(e.xLegendText).attr("dx",e.setLetterSpacing(e.xLegendText)).attr("class","legend-text"),w.append("g").attr("transform","translate("+(a/2-a-5)+","+(s/2+s/6)+")").append("text").attr("transform","rotate(270)").attr("class","legend-text").attr("dx",e.setLetterSpacing(e.yLegendText)).text(e.yLegendText)}}}),$(function(){n.init({tnthDates:a.a,tnthAjax:i.a,SYSTEM_IDENTIFIER_ENUM:o.a,d3:d3})})}]);
//# sourceMappingURL=../../maps/psaTracker.bundle.js.map